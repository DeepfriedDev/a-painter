!function(t){function e(r){if(i[r])return i[r].exports;var s=i[r]={exports:{},id:r,loaded:!1};return t[r].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){window.saveAs=i(1).saveAs,i(4),i(6),i(7),i(8),i(9),i(10),i(11),i(12),i(13),i(14),i(15),i(18),i(19),i(20),i(21),i(22),i(23),i(24),i(25),i(27),i(28),i(29),i(30),i(31),i(16)},function(t,e,i){var r,s,n=n||function(t){"use strict";if(!("undefined"==typeof t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,i=function(){return t.URL||t.webkitURL||t},r=e.createElementNS("http://www.w3.org/1999/xhtml","a"),s="download"in r,n=function(t){var e=new MouseEvent("click");t.dispatchEvent(e)},a=/constructor/i.test(t.HTMLElement),o=/CriOS\/[\d]+/.test(navigator.userAgent),h=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},u="application/octet-stream",c=4e4,l=function(t){var e=function(){"string"==typeof t?i().revokeObjectURL(t):t.remove()};setTimeout(e,c)},d=function(t,e,i){e=[].concat(e);for(var r=e.length;r--;){var s=t["on"+e[r]];if("function"==typeof s)try{s.call(t,i||t)}catch(t){h(t)}}},m=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},p=function(e,h,c){c||(e=m(e));var p,f=this,g=e.type,b=g===u,v=function(){d(f,"writestart progress write writeend".split(" "))},E=function(){if((o||b&&a)&&t.FileReader){var r=new FileReader;return r.onloadend=function(){var e=o?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;"),i=t.open(e,"_blank");i||(t.location.href=e),e=void 0,f.readyState=f.DONE,v()},r.readAsDataURL(e),void(f.readyState=f.INIT)}if(p||(p=i().createObjectURL(e)),b)t.location.href=p;else{var s=t.open(p,"_blank");s||(t.location.href=p)}f.readyState=f.DONE,v(),l(p)};return f.readyState=f.INIT,s?(p=i().createObjectURL(e),void setTimeout(function(){r.href=p,r.download=h,n(r),v(),l(p),f.readyState=f.DONE})):void E()},f=p.prototype,g=function(t,e,i){return new p(t,e||t.name||"download",i)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,i){return e=e||t.name||"download",i||(t=m(t)),navigator.msSaveOrOpenBlob(t,e)}:(f.abort=function(){},f.readyState=f.INIT=0,f.WRITING=1,f.DONE=2,f.error=f.onwritestart=f.onprogress=f.onwrite=f.onabort=f.onerror=f.onwriteend=null,g)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof t&&t.exports?t.exports.saveAs=n:null!==i(2)&&null!==i(3)&&(r=[],s=function(){return n}.apply(e,r),!(void 0!==s&&(t.exports=s)))},function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},function(t,e){(function(e){t.exports=e}).call(e,{})},function(t,e,i){function r(){this.map=(new THREE.TextureLoader).load("assets/images/"+s.meta.image)}const s=i(5);r.prototype={getUVConverters:function(t){return t?(t=t.replace("brushes/",""),{convertU:function(e){var i=s.meta.size,r=s.frames[t];return(e>1||e<0)&&(e=0),r.frame.x/i.w+e*r.frame.w/i.w},convertV:function(e){var i=s.meta.size,r=s.frames[t];return(e>1||e<0)&&(e=0),1-(r.frame.y/i.h+e*r.frame.h/i.h)}}):{convertU:function(t){return t},convertV:function(t){return t}}}},window.atlas=new r},function(t,e){t.exports={meta:{image:"brush_atlas.png",size:{w:3584,h:2944},scale:"1"},frames:{"stamp_grass.png":{frame:{x:0,y:128,w:1536,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:1536,h:512},sourceSize:{w:1536,h:512}},"lines4.png":{frame:{x:0,y:0,w:2048,h:128},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:2048,h:128},sourceSize:{w:2048,h:128}},"stamp_fur2.png":{frame:{x:0,y:640,w:1536,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:1536,h:512},sourceSize:{w:1536,h:512}},"stamp_bush.png":{frame:{x:0,y:1152,w:1024,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:1024,h:512},sourceSize:{w:1024,h:512}},"stamp_gear.png":{frame:{x:1024,y:1152,w:1024,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:1024,h:512},sourceSize:{w:1024,h:512}},"stamp_fur1.png":{frame:{x:2048,y:0,w:1024,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:1024,h:512},sourceSize:{w:1024,h:512}},"lines3.png":{frame:{x:2048,y:512,w:1024,h:256},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:1024,h:256},sourceSize:{w:1024,h:256}},"line_gradient.png":{frame:{x:2048,y:768,w:1024,h:256},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:1024,h:256},sourceSize:{w:1024,h:256}},"lines5.png":{frame:{x:2048,y:1024,w:1024,h:256},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:1024,h:256},sourceSize:{w:1024,h:256}},"silky_flat.png":{frame:{x:2048,y:1280,w:1024,h:256},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:1024,h:256},sourceSize:{w:1024,h:256}},"silky_textured.png":{frame:{x:0,y:1664,w:1024,h:256},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:1024,h:256},sourceSize:{w:1024,h:256}},"squared_textured.png":{frame:{x:1024,y:1664,w:1024,h:256},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:1024,h:256},sourceSize:{w:1024,h:256}},"line_grunge2.png":{frame:{x:2048,y:1664,w:1024,h:256},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:1024,h:256},sourceSize:{w:1024,h:256}},"line_grunge3.png":{frame:{x:0,y:1920,w:1024,h:256},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:1024,h:256},sourceSize:{w:1024,h:256}},"line_grunge1.png":{frame:{x:1024,y:1920,w:1024,h:256},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:1024,h:256},sourceSize:{w:1024,h:256}},"lines2.png":{frame:{x:2048,y:1920,w:1024,h:256},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:1024,h:256},sourceSize:{w:1024,h:256}},"stamp_leaf3.png":{frame:{x:1536,y:128,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"stamp_dots.png":{frame:{x:1536,y:640,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"thumb_stamp_star.png":{frame:{x:2304,y:1536,w:128,h:128},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:128,h:128},sourceSize:{w:128,h:128}},"stamp_grunge1.png":{frame:{x:512,y:2176,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"stamp_grunge2.png":{frame:{x:1024,y:2176,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"stamp_grunge3.png":{frame:{x:1536,y:2176,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"stamp_grunge4.png":{frame:{x:2048,y:2176,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"stamp_grunge5.png":{frame:{x:2560,y:2176,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"stamp_leaf1.png":{frame:{x:3072,y:0,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"stamp_leaf2.png":{frame:{x:3072,y:512,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"stamp_column.png":{frame:{x:3072,y:1024,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"stamp_snow.png":{frame:{x:3072,y:1536,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"stamp_squares.png":{frame:{x:3072,y:2048,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}},"lines1.png":{frame:{x:0,y:2688,w:256,h:256},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:256,h:256},sourceSize:{w:256,h:256}},"thumb_rainbow.png":{frame:{x:3072,y:2560,w:128,h:128},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:128,h:128},sourceSize:{w:128,h:128}},"thumb_single_sphere.png":{frame:{x:3200,y:2560,w:128,h:128},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:128,h:128},sourceSize:{w:128,h:128}},"thumb_stamp_fur1.png":{frame:{x:3328,y:2560,w:128,h:128},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:128,h:128},sourceSize:{w:128,h:128}},"thumb_stamp_fur2.png":{frame:{x:3456,y:2560,w:128,h:128},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:128,h:128},sourceSize:{w:128,h:128}},"thumb_stamp_grass.png":{frame:{x:2048,y:1536,w:128,h:128},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:128,h:128},sourceSize:{w:128,h:128}},"thumb_stamp_snow.png":{frame:{x:2176,y:1536,w:128,h:128},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:128,h:128},sourceSize:{w:128,h:128}},"stamp_star.png":{frame:{x:0,y:2176,w:512,h:512},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:512,h:512},sourceSize:{w:512,h:512}}}}},function(t,e){window.addEventListener("load",function(t){var e=document.body;e.addEventListener("dragover",function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},!1),e.addEventListener("drop",function(t){t.stopPropagation(),t.preventDefault();for(var e=t.dataTransfer.files,i=0;i<e.length;i++){var r=e[i];if(".apa"===r.name.substr(r.name.length-4).toLowerCase()){var s=new FileReader;s.onload=function(t){document.querySelector("a-scene").systems.brush.loadBinary(t.target.result)},s.readAsArrayBuffer(r)}else if(".json"===r.name.substr(r.name.length-5).toLowerCase()){var s=new FileReader;s.onload=function(t){document.querySelector("a-scene").systems.brush.loadJSON(JSON.parse(t.target.result))},s.readAsText(r)}else".obj"===r.name.substr(r.name.length-4).toLowerCase()?(s=new FileReader,s.onload=function(t){for(var e=new AFRAME.THREE.OBJLoader,i=e.parse(t.target.result),r=document.createElement("a-entity"),s=0;s<i.children.length;s++){var n=i.children[s];n.material.color.set("#333")}r.setObject3D("mesh",i),r.className="templateitem",document.querySelector("a-scene").appendChild(r)},s.readAsText(r)):r.type.match(/image.*/)&&(s=new FileReader,s.onload=function(t){var e=new Image;e.src=t.target.result;var i,r;e.width>e.height?(i=1,r=e.height/e.width):(r=1,i=e.width/e.height);var s=[3*Math.random()-1.5,1+Math.random()-.5,-1.4+.2*Math.random()],n=document.createElement("a-image");n.setAttribute("src",t.target.result),n.setAttribute("position",s.join(" ")),n.setAttribute("width",i),n.setAttribute("height",r),n.className="templateitem",document.querySelector("a-scene").appendChild(n)},s.readAsDataURL(r))}},!1)})},function(t,e){window.BinaryManager=function(t){this.dataview=new DataView(t),this.offset=0,this.isLittleEndian=!0},window.BinaryManager.prototype={readQuaternion:function(){return new THREE.Quaternion(this.readFloat(),this.readFloat(),this.readFloat(),this.readFloat())},readVector3:function(){return new THREE.Vector3(this.readFloat(),this.readFloat(),this.readFloat())},readString:function(){for(var t=this.dataview.getUint8(this.offset++,!0),e="",i=0;i<t;i++)e+=String.fromCharCode(this.dataview.getUint8(this.offset++,!0));return e},readColor:function(){return new THREE.Color(this.readFloat(),this.readFloat(),this.readFloat())},readFloat:function(){var t=this.dataview.getFloat32(this.offset,!0);return this.offset+=4,t},readUint32:function(){var t=this.dataview.getUint32(this.offset,!0);return this.offset+=4,t},readUint16:function(){var t=this.dataview.getUint16(this.offset,!0);return this.offset+=2,t},readUint8:function(){var t=this.dataview.getUint8(this.offset,!0);return this.offset++,t},writeVector:function(t){this.writeFloat32Array(t.toArray())},writeColor:function(t){this.writeFloat32Array(t.toArray())},writeString:function(t){this.writeUint8(t.length);for(var e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e))},writeUint8:function(t){this.dataview.setUint8(this.offset,t,this.isLittleEndian),this.offset++},writeUint16:function(t){this.dataview.setUint16(this.offset,t,this.isLittleEndian),this.offset+=2},writeUint32:function(t){this.dataview.setUint32(this.offset,t,this.isLittleEndian),this.offset+=4},writeFloat32:function(t){this.dataview.setFloat32(this.offset,t,this.isLittleEndian),this.offset+=4},writeFloat32Array:function(t){for(var e=0;e<t.length;e++)this.writeFloat32(t[e])},getDataView:function(){return this.dataview}}},function(t,e){THREE.OrbitControls=function(t,e){function i(){return 2*Math.PI/60/60*H.autoRotateSpeed}function r(){return Math.pow(.95,H.zoomSpeed)}function s(t){D.theta-=t}function n(t){D.phi-=t}function a(t){H.object instanceof THREE.PerspectiveCamera?N/=t:H.object instanceof THREE.OrthographicCamera?(H.object.zoom=Math.max(H.minZoom,Math.min(H.maxZoom,H.object.zoom*t)),H.object.updateProjectionMatrix(),q=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),H.enableZoom=!1)}function o(t){H.object instanceof THREE.PerspectiveCamera?N*=t:H.object instanceof THREE.OrthographicCamera?(H.object.zoom=Math.max(H.minZoom,Math.min(H.maxZoom,H.object.zoom/t)),H.object.updateProjectionMatrix(),q=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),H.enableZoom=!1)}function h(t){W.set(t.clientX,t.clientY)}function u(t){K.set(t.clientX,t.clientY)}function c(t){Y.set(t.clientX,t.clientY)}function l(t){J.set(t.clientX,t.clientY),Z.subVectors(J,W);var e=H.domElement===document?H.domElement.body:H.domElement;s(2*Math.PI*Z.x/e.clientWidth*H.rotateSpeed),n(2*Math.PI*Z.y/e.clientHeight*H.rotateSpeed),W.copy(J),H.update()}function d(t){G.set(t.clientX,t.clientY),$.subVectors(G,K),$.y>0?a(r()):$.y<0&&o(r()),K.copy(G),H.update()}function m(t){X.set(t.clientX,t.clientY),Q.subVectors(X,Y),it(Q.x,Q.y),Y.copy(X),H.update()}function p(t){}function f(t){t.deltaY<0?o(r()):t.deltaY>0&&a(r()),H.update()}function g(t){switch(t.keyCode){case H.keys.UP:it(0,H.keyPanSpeed),H.update();break;case H.keys.BOTTOM:it(0,-H.keyPanSpeed),H.update();break;case H.keys.LEFT:it(H.keyPanSpeed,0),H.update();break;case H.keys.RIGHT:it(-H.keyPanSpeed,0),H.update()}}function b(t){W.set(t.touches[0].pageX,t.touches[0].pageY)}function v(t){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+i*i);K.set(0,r)}function E(t){Y.set(t.touches[0].pageX,t.touches[0].pageY)}function y(t){J.set(t.touches[0].pageX,t.touches[0].pageY),Z.subVectors(J,W);var e=H.domElement===document?H.domElement.body:H.domElement;s(2*Math.PI*Z.x/e.clientWidth*H.rotateSpeed),n(2*Math.PI*Z.y/e.clientHeight*H.rotateSpeed),W.copy(J),H.update()}function w(t){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,s=Math.sqrt(e*e+i*i);G.set(0,s),$.subVectors(G,K),$.y>0?o(r()):$.y<0&&a(r()),K.copy(G),H.update()}function x(t){X.set(t.touches[0].pageX,t.touches[0].pageY),Q.subVectors(X,Y),it(Q.x,Q.y),Y.copy(X),H.update()}function S(t){}function T(t){if(H.enabled!==!1){if(t.preventDefault(),t.button===H.mouseButtons.ORBIT){if(H.enableRotate===!1)return;h(t),U=I.ROTATE}else if(t.button===H.mouseButtons.ZOOM){if(H.enableZoom===!1)return;u(t),U=I.DOLLY}else if(t.button===H.mouseButtons.PAN){if(H.enablePan===!1)return;c(t),U=I.PAN}U!==I.NONE&&(document.addEventListener("mousemove",R,!1),document.addEventListener("mouseup",A,!1),H.dispatchEvent(z))}}function R(t){if(H.enabled!==!1)if(t.preventDefault(),U===I.ROTATE){if(H.enableRotate===!1)return;l(t)}else if(U===I.DOLLY){if(H.enableZoom===!1)return;d(t)}else if(U===I.PAN){if(H.enablePan===!1)return;m(t)}}function A(t){H.enabled!==!1&&(p(t),document.removeEventListener("mousemove",R,!1),document.removeEventListener("mouseup",A,!1),H.dispatchEvent(P),U=I.NONE)}function M(t){H.enabled===!1||H.enableZoom===!1||U!==I.NONE&&U!==I.ROTATE||(t.preventDefault(),t.stopPropagation(),f(t),H.dispatchEvent(z),H.dispatchEvent(P))}function O(t){H.enabled!==!1&&H.enableKeys!==!1&&H.enablePan!==!1&&g(t)}function _(t){if(H.enabled!==!1){switch(t.touches.length){case 1:if(H.enableRotate===!1)return;b(t),U=I.TOUCH_ROTATE;break;case 2:if(H.enableZoom===!1)return;v(t),U=I.TOUCH_DOLLY;break;case 3:if(H.enablePan===!1)return;E(t),U=I.TOUCH_PAN;break;default:U=I.NONE}U!==I.NONE&&H.dispatchEvent(z)}}function j(t){if(H.enabled!==!1)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(H.enableRotate===!1)return;if(U!==I.TOUCH_ROTATE)return;y(t);break;case 2:if(H.enableZoom===!1)return;if(U!==I.TOUCH_DOLLY)return;w(t);break;case 3:if(H.enablePan===!1)return;if(U!==I.TOUCH_PAN)return;x(t);break;default:U=I.NONE}}function k(t){H.enabled!==!1&&(S(t),H.dispatchEvent(P),U=I.NONE)}function B(t){t.preventDefault()}this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return F.phi},this.getAzimuthalAngle=function(){return F.theta},this.reset=function(){H.target.copy(H.target0),H.object.position.copy(H.position0),H.object.zoom=H.zoom0,H.object.updateProjectionMatrix(),H.dispatchEvent(C),H.update(),U=I.NONE},this.update=function(){var e=new THREE.Vector3,r=(new THREE.Quaternion).setFromUnitVectors(t.up,new THREE.Vector3(0,1,0)),n=r.clone().inverse(),a=new THREE.Vector3,o=new THREE.Quaternion;return function(){var t=H.object.position;return e.copy(t).sub(H.target),e.applyQuaternion(r),F.setFromVector3(e),H.autoRotate&&U===I.NONE&&s(i()),F.theta+=D.theta,F.phi+=D.phi,F.theta=Math.max(H.minAzimuthAngle,Math.min(H.maxAzimuthAngle,F.theta)),F.phi=Math.max(H.minPolarAngle,Math.min(H.maxPolarAngle,F.phi)),F.makeSafe(),F.radius*=N,F.radius=Math.max(H.minDistance,Math.min(H.maxDistance,F.radius)),H.target.add(V),e.setFromSpherical(F),e.applyQuaternion(n),t.copy(H.target).add(e),H.object.lookAt(H.target),H.enableDamping===!0?(D.theta*=1-H.dampingFactor,D.phi*=1-H.dampingFactor):D.set(0,0,0),N=1,V.set(0,0,0),!!(q||a.distanceToSquared(H.object.position)>L||8*(1-o.dot(H.object.quaternion))>L)&&(H.dispatchEvent(C),a.copy(H.object.position),o.copy(H.object.quaternion),q=!1,!0)}}(),this.dispose=function(){H.domElement.removeEventListener("contextmenu",B,!1),H.domElement.removeEventListener("mousedown",T,!1),H.domElement.removeEventListener("wheel",M,!1),H.domElement.removeEventListener("touchstart",_,!1),H.domElement.removeEventListener("touchend",k,!1),H.domElement.removeEventListener("touchmove",j,!1),document.removeEventListener("mousemove",R,!1),document.removeEventListener("mouseup",A,!1),window.removeEventListener("keydown",O,!1)};var H=this,C={type:"change"},z={type:"start"},P={type:"end"},I={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},U=I.NONE,L=1e-6,F=new THREE.Spherical,D=new THREE.Spherical,N=1,V=new THREE.Vector3,q=!1,W=new THREE.Vector2,J=new THREE.Vector2,Z=new THREE.Vector2,Y=new THREE.Vector2,X=new THREE.Vector2,Q=new THREE.Vector2,K=new THREE.Vector2,G=new THREE.Vector2,$=new THREE.Vector2,tt=function(){var t=new THREE.Vector3;return function(e,i){t.setFromMatrixColumn(i,0),t.multiplyScalar(-e),V.add(t)}}(),et=function(){var t=new THREE.Vector3;return function(e,i){t.setFromMatrixColumn(i,1),t.multiplyScalar(e),V.add(t)}}(),it=function(){var t=new THREE.Vector3;return function(e,i){var r=H.domElement===document?H.domElement.body:H.domElement;if(H.object instanceof THREE.PerspectiveCamera){var s=H.object.position;t.copy(s).sub(H.target);var n=t.length();n*=Math.tan(H.object.fov/2*Math.PI/180),tt(2*e*n/r.clientHeight,H.object.matrix),et(2*i*n/r.clientHeight,H.object.matrix)}else H.object instanceof THREE.OrthographicCamera?(tt(e*(H.object.right-H.object.left)/H.object.zoom/r.clientWidth,H.object.matrix),et(i*(H.object.top-H.object.bottom)/H.object.zoom/r.clientHeight,H.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),H.enablePan=!1)}}();H.domElement.addEventListener("contextmenu",B,!1),H.domElement.addEventListener("mousedown",T,!1),H.domElement.addEventListener("wheel",M,!1),H.domElement.addEventListener("touchstart",_,!1),H.domElement.addEventListener("touchend",k,!1),H.domElement.addEventListener("touchmove",j,!1),window.addEventListener("keydown",O,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(t){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!t}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(t){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!t}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(t){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!t}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(t){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!t}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(t){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!t}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(t){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=t}}})},function(t,e,i){function r(){this.sharedBuffers={}}var s=i(10);r.prototype={addSharedBuffer:function(t,e,i){var r=new s(e,i);this.sharedBuffers[t]=r},getSharedBuffer:function(t){return this.sharedBuffers[t]}},t.exports=new r},function(t,e){function i(t,e){this.material=t,this.primitiveMode=e,this.maxBufferSize=1e6,this.geometries=[],this.current=null,this.addBuffer(!1)}i.prototype={restartPrimitive:function(){if(this.idx.position>=this.current.attributes.position.count)this.addBuffer(!1);else if(0!==this.idx.position){var t=3*(this.idx.position-1),e=this.current.attributes.position.array;this.addVertex(e[t++],e[t++],e[t++]),this.idx.color++,this.idx.normal++,this.idx.uv++}},remove:function(t,e){var i=this.current.attributes.position.array;if(this.idx.position>e.position)for(key in this.idx)for(var r="uv"===key?2:3,i=t[key]*r,s=(e[key]+1)*r,n=this.idx[key]*r,a=s;a<n;a++)this.current.attributes[key].array[i++]=this.current.attributes[key].array[a];for(key in this.idx){var o=e[key]-t[key];this.idx[key]-=o}this.update()},undo:function(t){this.idx=t,this.update()},addBuffer:function(t){var e=new THREE.BufferGeometry,i=new Float32Array(3*this.maxBufferSize),r=new Float32Array(3*this.maxBufferSize),s=new Float32Array(2*this.maxBufferSize),n=new Float32Array(3*this.maxBufferSize),a=new THREE.Mesh(e,this.material);a.drawMode=this.primitiveMode,a.frustumCulled=!1,a.vertices=i,this.object3D=new THREE.Object3D;var o=document.querySelector(".a-drawing");if(o||(o=document.createElement("a-entity"),o.className="a-drawing",document.querySelector("a-scene").appendChild(o)),o.object3D.add(this.object3D),this.object3D.add(a),e.setDrawRange(0,0),e.addAttribute("position",new THREE.BufferAttribute(i,3).setDynamic(!0)),e.addAttribute("uv",new THREE.BufferAttribute(s,2).setDynamic(!0)),e.addAttribute("normal",new THREE.BufferAttribute(r,3).setDynamic(!0)),e.addAttribute("color",new THREE.BufferAttribute(n,3).setDynamic(!0)),this.previous=null,this.geometries.length>0&&(this.previous=this.current),this.idx={position:0,uv:0,normal:0,color:0},this.geometries.push(e),this.current=e,this.previous&&t){var h=3*(this.maxBufferSize-2),u=3*(this.maxBufferSize-2),c=(2*(this.maxBufferSize-2),3*(this.maxBufferSize-2)),l=this.previous.attributes.position.array;this.addVertex(l[h++],l[h++],l[h++]),this.addVertex(l[h++],l[h++],l[h++]);var d=this.previous.attributes.normal.array;this.addNormal(d[c++],d[c++],d[c++]),this.addNormal(d[c++],d[c++],d[c++]);var m=this.previous.attributes.color.array;this.addColor(m[u++],m[u++],m[u++]),this.addColor(m[u++],m[u++],m[u++]);var s=this.previous.attributes.uv.array}},addColor:function(t,e,i){this.current.attributes.color.setXYZ(this.idx.color++,t,e,i)},addNormal:function(t,e,i){this.current.attributes.normal.setXYZ(this.idx.normal++,t,e,i)},addVertex:function(t,e,i){var r=this.current.attributes.position;this.idx.position===r.count&&(this.addBuffer(!0),r=this.current.attributes.position),r.setXYZ(this.idx.position++,t,e,i)},addUV:function(t,e){this.current.attributes.uv.setXY(this.idx.uv++,t,e)},update:function(){this.current.setDrawRange(0,this.idx.position),this.current.attributes.color.needsUpdate=!0,this.current.attributes.normal.needsUpdate=!0,this.current.attributes.position.needsUpdate=!0,this.current.attributes.uv.needsUpdate=!0}},t.exports=i},function(t,e){window.Utils=function(){function t(t){return parseFloat(t.toFixed(r))}function e(e){for(var i=0;i<e.length;i++)e[i]=t(e[i]);return e}function i(t){var e,i;switch(t){case"windows-motion-samsung-controls":i=".windows-motion-samsung-tooltips";break;case"windows-motion-controls":i=".windows-motion-tooltips";break;case"oculus-touch-controls":i=".oculus-tooltips";break;case"vive-controls":i=".vive-tooltips"}return e=Array.prototype.slice.call(document.querySelectorAll(i))}const r=6;return{numberToFixed:t,arrayNumbersToFixed:e,getTooltips:i}}()},function(t,e){window.addEventListener("load",function(t){var e=document.getElementById("apainter-ui"),i=document.querySelector("#apainter-ui .share"),r=document.getElementById("apainter-share-url"),s=document.querySelector("#apainter-ui .progress"),n=document.querySelector("#apainter-ui .bar");document.addEventListener("drawing-upload-completed",function(t){i.classList.remove("hide"),s.classList.add("hide"),r.value=t.detail.url}),document.addEventListener("drawing-upload-started",function(t){e.style.display="block",i.classList.add("hide"),s.classList.remove("hide")}),document.addEventListener("drawing-upload-progress",function(t){n.style.width=Math.floor(100*t.detail.progress)+"%"});var a=new Clipboard(".button.copy");a.on("error",function(t){console.error("Error copying to clipboard:",t.action,t.trigger)})})},function(t,e){var r=1;AFRAME.BRUSHES={},APAINTER_STATS={brushes:{}},AFRAME.registerBrush=function(t,e,i){function r(t){return function(e,i,r,s){this.object3D=new THREE.Object3D,this.data={points:[],size:i,prevPosition:null,prevPointerPosition:null,numPoints:0,color:e.clone(),timestamp:s,owner:r},t.call(this,e,i)}}function s(t){return function(e,i,r,s,n){this.data.prevPosition&&this.data.prevPosition.distanceTo(e)<=this.options.spacing||0!==this.options.maxPoints&&this.data.numPoints>=this.options.maxPoints||t.call(this,e,i,r,s,n)&&(this.data.numPoints++,this.data.points.push({position:e.clone(),orientation:i.clone(),pressure:s,timestamp:n}),this.data.prevPosition=e.clone(),this.data.prevPointerPosition=r.clone())}}var n={};if(Object.keys(e).forEach(function(t){n[t]={value:e[t],writable:!0}}),AFRAME.BRUSHES[t])throw new Error("The brush `"+t+"` has been already registered. Check that you are not loading two versions of the same brush or two different brushes of the same name.");var a=function(){},o={spacing:0,maxPoints:0};a.prototype={options:Object.assign(o,i),reset:function(){},tick:function(t,e){},undo:function(){},remove:function(){},addPoint:function(t,e,i,r,s){},getJSON:function(t){for(var e=[],i=0;i<this.data.points.length;i++){var r=this.data.points[i];e.push({orientation:Utils.arrayNumbersToFixed(r.orientation.toArray()),position:Utils.arrayNumbersToFixed(r.position.toArray()),pressure:Utils.numberToFixed(r.pressure),timestamp:r.timestamp})}return{brush:{index:t.getUsedBrushes().indexOf(this.brushName),color:Utils.arrayNumbersToFixed(this.data.color.toArray()),size:Utils.numberToFixed(this.data.size)},points:e}},getBinary:function(t){var e=21+36*this.data.points.length,i=new BinaryManager(new ArrayBuffer(e));i.writeUint8(t.getUsedBrushes().indexOf(this.brushName)),i.writeColor(this.data.color),i.writeFloat32(this.data.size),i.writeUint32(this.data.points.length);for(var r=0;r<this.data.points.length;r++){var s=this.data.points[r];i.writeFloat32Array(s.position.toArray()),i.writeFloat32Array(s.orientation.toArray()),i.writeFloat32(s.pressure),i.writeUint32(s.timestamp)}return i.getDataView()}};var h=function(){};return h.prototype=Object.create(a.prototype,n),h.prototype.brushName=t,h.prototype.constructor=h,h.prototype.init=r(h.prototype.init),h.prototype.addPoint=s(h.prototype.addPoint),AFRAME.BRUSHES[t]=h,h.used=!1,h},AFRAME.registerSystem("brush",{schema:{},brushes:{},strokes:[],getUsedBrushes:function(){return Object.keys(AFRAME.BRUSHES).filter(function(t){return AFRAME.BRUSHES[t].used})},getBrushByName:function(t){return AFRAME.BRUSHES[t]},undo:function(){for(var t,e=this.strokes.length-1;e>=0;e--)if("local"===this.strokes[e].data.owner){t=this.strokes.splice(e,1)[0];break}if(t){t.undo();var i=document.querySelector(".a-drawing");i.emit("stroke-removed",{stroke:t})}},removeById:function(t){t=1;var e=this.strokes[t];if(console.log(e,this.strokes),e){for(var i=this.strokes.length-1;i>t;i--)if(stroke=this.strokes[i],e.sharedBuffer===stroke.sharedBuffer){console.log(">>>",stroke.prevIdx,"->",stroke.idx,"target",e.prevIdx,"->",e.idx);for(key in e.idx){var r=e.idx[key]-e.prevIdx[key];stroke.idx[key]-=r,stroke.prevIdx[key]-=r}console.log("<<<",stroke.idx,stroke.prevIdx)}this.strokes.splice(t,1)[0].remove()}},clear:function(){for(var t=this.strokes.length-1;t>=0;t--)if("local"===this.strokes[t].data.owner){var e=this.strokes[t];e.undo();var i=document.querySelector(".a-drawing");i.emit("stroke-removed",{stroke:e})}Object.keys(AFRAME.BRUSHES).forEach(function(t){AFRAME.BRUSHES[t].used=!1}),this.strokes=[]},init:function(){this.version=r,this.clear(),this.controllerName=null;var t=this;this.sceneEl.addEventListener("controllerconnected",function(e){t.controllerName=e.detail.name})},tick:function(t,e){if(this.strokes.length)for(var i=0;i<this.strokes.length;i++)this.strokes[i].tick(t,e)},generateTestLines:function(){var t=-2,e=.5,i=3,r=1,s=4,n=i/s,a=Object.keys(AFRAME.BRUSHES);brushesNames2=["leaf1","fur2","star","squared-textured","flat","squared-textured","lines5"];var o=-(e+.1)*a.length/2;o=0;var h=0;a.forEach(function(i){var a=new THREE.Color(Math.random(),Math.random(),Math.random()),u=this.addNewStroke(i,a,e),c=document.querySelector("#left-hand");c.emit("stroke-started",{entity:c,stroke:u});for(var l=new THREE.Vector3(o,h,t),d=new THREE.Vector3,m=0;m<s;m++){var p=new THREE.Quaternion;d.set(0,n,.1);var f=new THREE.Euler(0,Math.PI,0);p.setFromEuler(f),l=l.add(d);var g=0,b=this.getPointerPosition(l,p);u.addPoint(l,p,b,r,g)}o+=e+.1})},generateRandomStrokes:function(t){function e(){return 2*Math.random()-1}for(var i=document.querySelector("#left-hand"),r=Object.keys(AFRAME.BRUSHES),s=0;s<t;s++){var n=r[parseInt(13*Math.random())],a=new THREE.Color(Math.random(),Math.random(),Math.random()),o=.3*Math.random(),h=parseInt(500*Math.random()),u=this.addNewStroke(n,a,o);i.emit("stroke-started",{
entity:i,stroke:u});for(var c=new THREE.Vector3(e(),e(),e()),l=new THREE.Vector3,d=new THREE.Quaternion,m=.2,p=0;p<h;p++){l.set(e(),e(),e()),l.multiplyScalar(e()/20),d.setFromUnitVectors(c.clone().normalize(),l.clone().normalize()),c=c.add(l),c.y<0&&(c.y=-c.y);var f=0;m+=1-2*Math.random(),m<0&&(m=.2),m>1&&(m=1);var g=this.getPointerPosition(c,d);u.addPoint(c,d,g,m,f)}}},addNewStroke:function(t,e,i,r,s){APAINTER_STATS.brushes[t]||(APAINTER_STATS.brushes[t]=0),APAINTER_STATS.brushes[t]++,r=r||"local",s=s||Date.now();var n=this.getBrushByName(t);if(!n){var a=Object.keys(AFRAME.BRUSHES)[0];n=AFRAME.BRUSHES[a],console.warn("Invalid brush name: `"+t+"` using `"+a+"`")}n.used=!0;var o=new n;o.brush=n,o.init(e,i,r,s),this.strokes.push(o);var h=document.querySelector(".a-drawing");return h||(h=document.createElement("a-entity"),h.className="a-drawing",document.querySelector("a-scene").appendChild(h)),o},getJSON:function(){var t={version:r,strokes:[],author:"",brushes:this.getUsedBrushes()};for(i=0;i<this.strokes.length;i++)t.strokes.push(this.strokes[i].getJSON(this));return t},getBinary:function(){var t=[],e="apainter",i=this.getUsedBrushes(),s=e.length+i.join(" ").length+9,n=new BinaryManager(new ArrayBuffer(s));n.writeString(e),n.writeUint16(r),n.writeUint8(i.length);for(var a=0;a<i.length;a++)n.writeString(i[a]);for(n.writeUint32(this.strokes.length),t.push(n.getDataView()),a=0;a<this.strokes.length;a++)t.push(this.strokes[a].getBinary(this));return t},getPointerPosition:function(){var t=new THREE.Vector3,e={"vive-controls":{vec:new THREE.Vector3(0,.7,1),mult:-.03},"oculus-touch-controls":{vec:new THREE.Vector3(0,0,2.8),mult:-.05},"windows-motion-controls":{vec:new THREE.Vector3(0,0,1),mult:-.12}};return function(i,r){if(!this.controllerName)return i;var s=e[this.controllerName],n=s.vec.clone().applyQuaternion(r).normalize().multiplyScalar(s.mult);return t.copy(i).add(n),t}}(),loadJSON:function(t){t.version!==r&&console.error("Invalid version: ",t.version,"(Expected: "+r+")"),console.time("JSON Loading");for(var e=0;e<t.strokes.length;e++)for(var i=t.strokes[e],s=i.brush,n=this.addNewStroke(t.brushes[s.index],(new THREE.Color).fromArray(s.color),s.size),a=0;a<i.points.length;a++){var o=i.points[a],h=(new THREE.Vector3).fromArray(o.position),u=(new THREE.Quaternion).fromArray(o.orientation),c=o.pressure,l=o.timestamp,d=this.getPointerPosition(h,u);n.addPoint(h,u,d,c,l)}console.timeEnd("JSON Loading")},loadBinary:function(t){var e=new BinaryManager(t),i=e.readString();if("apainter"!==i)return void console.error("Invalid `magic` header");var s=e.readUint16();s!==r&&console.error("Invalid version: ",s,"(Expected: "+r+")"),console.time("Binary Loading");for(var n=e.readUint8(),a=[],o=0;o<n;o++)a.push(e.readString());for(var h=e.readUint32(),u=0;u<h;u++)for(var c=e.readUint8(),l=e.readColor(),d=e.readFloat(),m=e.readUint32(),p=this.addNewStroke(a[c],l,d),f=0;f<m;f++){var g=e.readVector3(),b=e.readQuaternion(),v=e.readFloat(),E=e.readUint32(),y=this.getPointerPosition(g,b);p.addPoint(g,b,y,v,E)}console.timeEnd("Binary Loading")},loadFromUrl:function(t,e){var i=new THREE.XHRLoader(this.manager);i.crossOrigin="anonymous",e===!0&&i.setResponseType("arraybuffer");var r=this;i.load(t,function(t){e===!0?r.loadBinary(t):r.loadJSON(JSON.parse(t))})}})},function(t,e){AFRAME.registerSystem("ui",{init:function(){this.initTextures()},initTextures:function(){function t(t){i.hoverTexture=t}function e(t){i.pressedTexture=t}var i=this,r="assets/images/ui-hover.png",s="assets/images/ui-pressed.png";this.sceneEl.systems.material.loadTexture(r,{src:r},t),this.sceneEl.systems.material.loadTexture(s,{src:s},e)},closeAll:function(){var t,e=document.querySelectorAll("[ui]");for(t=0;t<e.length;t++)e[t].components.ui.close()}})},function(t,e,i){var r=i(1).saveAs;AFRAME.TWEEN=i(16),AFRAME.registerSystem("painter",{init:function(){function t(){var t,e=/\+/g,i=/([^&=]+)=?([^&]*)/g,r=function(t){return decodeURIComponent(t.replace(e," "))},s=window.location.search.substring(1),n={};for(t=i.exec(s);t;)n[r(t[1])]=r(t[2]),t=i.exec(s);return n}var e={behaviours:{},mappings:{painting:{common:{"grip.down":"undo","trigger.changed":"paint"},"vive-controls":{"axis.move":"changeBrushSizeInc","trackpad.touchstart":"startChangeBrushSize","menu.down":"toggleMenu","trackpad.down":"aim","trackpad.up":"teleport"},"oculus-touch-controls":{"axis.move":"changeBrushSizeAbs","abutton.down":"toggleMenu","xbutton.down":"toggleMenu","ybutton.down":"aim","ybutton.up":"teleport","bbutton.down":"aim","bbutton.up":"teleport"},"windows-motion-controls":{"axis.move":"changeBrushSizeAbs","menu.down":"toggleMenu","trackpad.down":"aim","trackpad.up":"teleport"}}}};this.sceneEl.addEventListener("loaded",function(){AFRAME.registerInputMappings(e),AFRAME.currentInputMapping="painting"}),this.version="1.2",this.brushSystem=this.sceneEl.systems.brush,this.showTemplateItems=!0;var i=t();if(i.url||i.urljson){var r=void 0===i.urljson;this.brushSystem.loadFromUrl(i.url||i.urljson,r),document.getElementById("logo").setAttribute("visible",!1),document.getElementById("acamera").setAttribute("orbit-controls","position","0 1.6 3"),document.getElementById("apainter-logo").classList.remove("hidden")}void 0!==i.bgcolor&&(document.body.style.backgroundColor="#"+i.bgcolor),void 0!==i.sky&&this.sceneEl.addEventListener("loaded",function(t){""===i.sky?document.getElementById("sky").setAttribute("visible",!1):document.getElementById("sky").setAttribute("material","src",i.sky)}),void 0!==i.floor&&this.sceneEl.addEventListener("loaded",function(t){""===i.floor?document.getElementById("ground").setAttribute("visible",!1):document.getElementById("ground").setAttribute("material","src",i.floor)}),this.startPainting=!1;var s=this;document.addEventListener("stroke-started",function(t){if(!s.startPainting){var e=document.getElementById("logo"),i=e.getObject3D("mesh");new AFRAME.TWEEN.Tween({alpha:1}).to({alpha:0},4e3).onComplete(function(){e.setAttribute("visible",!1)}).onUpdate(function(){i.children[0].material.opacity=this.alpha}).start();s.startPainting=!0}}),document.addEventListener("keyup",function(t){if(!t.shiftKey&&!t.ctrlKey){if(8===t.keyCode&&s.brushSystem.undo(),67===t.keyCode&&s.brushSystem.clear(),71===t.keyCode){var e=document.querySelector(".a-drawing");s.sceneEl.systems["gltf-exporter"].export(e)}if(78===t.keyCode){var i=document.querySelectorAll("[paint-controls]"),r=Object.keys(AFRAME.BRUSHES),n=r.indexOf(i[0].components.brush.data.brush);n=(n+1)%r.length,[].forEach.call(i,function(t){t.setAttribute("brush","brush",r[n])})}if(84===t.keyCode&&s.brushSystem.generateTestLines(),82===t.keyCode&&s.brushSystem.generateRandomStrokes(1),76===t.keyCode&&s.brushSystem.loadFromUrl("demo.apa",!0),85===t.keyCode&&s.upload(),86===t.keyCode&&s.save(),74===t.keyCode&&s.saveJSON(),79===t.keyCode){s.showTemplateItems=!s.showTemplateItems;for(var a=document.querySelectorAll(".templateitem"),o=0;o<a.length;o++)a[o].setAttribute("visible",s.showTemplateItems)}88===t.keyCode&&s.brushSystem.removeById(2)}}),console.info("A-PAINTER Version: "+this.version)},saveJSON:function(){var t=this.brushSystem.getJSON(),e=new Blob([JSON.stringify(t)],{type:"application/json"});r(e,"demo.json")},save:function(){var t=this.brushSystem.getBinary(),e=new Blob(t,{type:"application/octet-binary"});r(e,"demo.apa")},upload:function(t,e){this.sceneEl.emit("drawing-upload-started");var i=this,r="https://aframe.io/a-painter/?url=",s=this.brushSystem.getBinary(),n=new Blob(s,{type:"application/octet-binary"}),a="uploadcare";if("fileio"===a){var o=new window.FormData;o.append("file",n);var h=new window.XMLHttpRequest;h.open("POST","https://file.io"),h.onreadystatechange=function(s){if(4===h.readyState){var n=JSON.parse(h.response);n.success&&(console.log("Uploaded link: ",r+n.link),i.sceneEl.emit("drawing-upload-completed",{url:r+n.link}),t&&t())}else i.sceneEl.emit("drawing-upload-error",{errorInfo:null,fileInfo:null}),e&&e()},h.send(o)}else{var u=uploadcare.fileFrom("object",n);u.done(function(e){console.log("Uploaded link: ",r+e.cdnUrl),i.sceneEl.emit("drawing-upload-completed",{url:r+e.cdnUrl}),t&&t()}).fail(function(t,r){i.sceneEl.emit("drawing-upload-error",{errorInfo:t,fileInfo:r}),e&&e(t)}).progress(function(t){i.sceneEl.emit("drawing-upload-progress",{progress:t.progress})})}},tick:function(t,e){AFRAME.TWEEN.update()}})},function(t,e,i){var r,s;(function(i){var n=function(){this._tweens={},this._tweensAddedDuringUpdate={}};n.prototype={getAll:function(){return Object.keys(this._tweens).map(function(t){return this._tweens[t]}.bind(this))},removeAll:function(){this._tweens={}},add:function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},remove:function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},update:function(t,e){var i=Object.keys(this._tweens);if(0===i.length)return!1;for(t=void 0!==t?t:a.now();i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++)this._tweens[i[r]].update(t)===!1&&(this._tweens[i[r]]._isPlaying=!1,e||delete this._tweens[i[r]]);i=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var a=new n;a.Group=n,a._nextId=0,a.nextId=function(){return a._nextId++},"undefined"==typeof window&&"undefined"!=typeof i?a.now=function(){var t=i.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?a.now=window.performance.now.bind(window.performance):void 0!==Date.now?a.now=Date.now:a.now=function(){return(new Date).getTime()},a.Tween=function(t,e){this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=a.Easing.Linear.None,this._interpolationFunction=a.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=e||a,this._id=a.nextId()},a.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(t,e){return this._valuesEnd=t,void 0!==e&&(this._duration=e),this},start:function(t){this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==t?t:a.now(),this._startTime+=this._delayTime;for(var e in this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(0===this._valuesEnd[e].length)continue;this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}void 0!==this._object[e]&&(this._valuesStart[e]=this._object[e],this._valuesStart[e]instanceof Array==!1&&(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback.call(this._object,this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop()},delay:function(t){return this._delayTime=t,this},repeat:function(t){return this._repeat=t,this},repeatDelay:function(t){return this._repeatDelayTime=t,this},yoyo:function t(t){return this._yoyo=t,this},easing:function t(t){return this._easingFunction=t,this},interpolation:function t(t){return this._interpolationFunction=t,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(t){return this._onStartCallback=t,this},onUpdate:function(t){return this._onUpdateCallback=t,this},onComplete:function(t){return this._onCompleteCallback=t,this},onStop:function(t){return this._onStopCallback=t,this},update:function(t){var e,i,r;if(t<this._startTime)return!0;this._onStartCallbackFired===!1&&(null!==this._onStartCallback&&this._onStartCallback.call(this._object,this._object),this._onStartCallbackFired=!0),i=(t-this._startTime)/this._duration,i=i>1?1:i,r=this._easingFunction(i);for(e in this._valuesEnd)if(void 0!==this._valuesStart[e]){var s=this._valuesStart[e]||0,n=this._valuesEnd[e];n instanceof Array?this._object[e]=this._interpolationFunction(n,r):("string"==typeof n&&(n="+"===n.charAt(0)||"-"===n.charAt(0)?s+parseFloat(n):parseFloat(n)),"number"==typeof n&&(this._object[e]=s+(n-s)*r))}if(null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._object,r),1===i){if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(e in this._valuesStartRepeat){if("string"==typeof this._valuesEnd[e]&&(this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(this._valuesEnd[e])),this._yoyo){var a=this._valuesStartRepeat[e];this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=a}this._valuesStart[e]=this._valuesStartRepeat[e]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback.call(this._object,this._object);for(var o=0,h=this._chainedTweens.length;o<h;o++)this._chainedTweens[o].start(this._startTime+this._duration);return!1}return!0}},a.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-a.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*a.Easing.Bounce.In(2*t):.5*a.Easing.Bounce.Out(2*t-1)+.5}}},a.Interpolation={Linear:function(t,e){var i=t.length-1,r=i*e,s=Math.floor(r),n=a.Interpolation.Utils.Linear;return e<0?n(t[0],t[1],r):e>1?n(t[i],t[i-1],i-r):n(t[s],t[s+1>i?i:s+1],r-s)},Bezier:function(t,e){for(var i=0,r=t.length-1,s=Math.pow,n=a.Interpolation.Utils.Bernstein,o=0;o<=r;o++)i+=s(1-e,r-o)*s(e,o)*t[o]*n(r,o);return i},CatmullRom:function(t,e){var i=t.length-1,r=i*e,s=Math.floor(r),n=a.Interpolation.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(s=Math.floor(r=i*(1+e))),n(t[(s-1+i)%i],t[s],t[(s+1)%i],t[(s+2)%i],r-s)):e<0?t[0]-(n(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[i]-(n(t[i],t[i],t[i-1],t[i-1],r-i)-t[i]):n(t[s?s-1:0],t[s],t[i<s+1?i:s+1],t[i<s+2?i:s+2],r-s)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=a.Interpolation.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i=1;if(t[e])return t[e];for(var r=e;r>1;r--)i*=r;return t[e]=i,i}}(),CatmullRom:function(t,e,i,r,s){var n=.5*(i-t),a=.5*(r-e),o=s*s,h=s*o;return(2*e-2*i+n+a)*h+(-3*e+3*i-2*n-a)*o+n*s+e}}},function(i){r=[],s=function(){return a}.apply(e,r),!(void 0!==s&&(t.exports=s))}(this)}).call(e,i(17))},function(t,e){function i(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function s(t){if(c===setTimeout)return setTimeout(t,0);if((c===i||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function n(t){if(l===clearTimeout)return clearTimeout(t);if((l===r||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function a(){f&&m&&(f=!1,m.length?p=m.concat(p):g=-1,p.length&&o())}function o(){if(!f){var t=s(a);f=!0;for(var e=p.length;e;){for(m=p,p=[];++g<e;)m&&m[g].run();g=-1,e=p.length}m=null,f=!1,n(t)}}function h(t,e){this.fun=t,this.array=e}function u(){}var c,l,d=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:i}catch(t){c=i}try{l="function"==typeof clearTimeout?clearTimeout:r}catch(t){l=r}}();var m,p=[],f=!1,g=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];p.push(new h(t,e)),1!==p.length||f||s(o)},h.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=u,d.addListener=u,d.once=u,d.off=u,d.removeListener=u,d.removeAllListeners=u,d.emit=u,d.prependListener=u,d.prependOnceListener=u,d.listeners=function(t){return[]},d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(t,e){AFRAME.registerComponent("brush",{schema:{color:{type:"color",default:"#ef2d5e"},size:{default:.01,min:.001,max:.3},brush:{default:"smooth"},enabled:{default:!0}},init:function(){var t=this.data;this.color=new THREE.Color(t.color),this.el.emit("brushcolor-changed",{color:this.color}),this.el.emit("brushsize-changed",{brushSize:t.size}),this.active=!1,this.obj=this.el.object3D,this.currentStroke=null,this.strokeEntities=[],this.sizeModifier=0,this.textures={},this.currentMap=0,this.model=this.el.getObject3D("mesh"),this.drawing=!1;var e=this;this.previousAxis=0,this.el.addEventListener("undo",function(t){e.data.enabled&&(e.system.undo(),document.getElementById("ui_undo").play())}),this.el.addEventListener("paint",function(t){if(e.data.enabled){var i=t.detail.value;e.sizeModifier=i,i>.1?e.active||(e.startNewStroke(),e.active=!0):(e.active&&(e.previousEntity=e.currentEntity,e.currentStroke=null),e.active=!1)}})},update:function(t){var e=this.data;t.color!==e.color&&(this.color.set(e.color),this.el.emit("brushcolor-changed",{color:this.color})),t.size!==e.size&&this.el.emit("brushsize-changed",{size:e.size})},tick:function(){var t=new THREE.Vector3,e=new THREE.Quaternion,i=new THREE.Vector3;return function(r,s){if(this.currentStroke&&this.active){this.obj.matrixWorld.decompose(t,e,i);var n=this.system.getPointerPosition(t,e);this.currentStroke.addPoint(t,e,n,this.sizeModifier,r)}}}(),startNewStroke:function(){document.getElementById("ui_paint").play(),this.currentStroke=this.system.addNewStroke(this.data.brush,this.color,this.data.size),this.el.emit("stroke-started",{entity:this.el,stroke:this.currentStroke})}})},function(t,e){var i=AFRAME.utils;AFRAME.registerComponent("if-no-vr-headset",{schema:{default:{},parse:i.styleParser.parse},update:function(){var t=this;return this.el.sceneEl.isMobile?void this.setProperties():void navigator.getVRDisplays().then(function(e){e.length&&"Emulated HTC Vive DVT"!==e[0].displayName||t.setProperties()})},setProperties:function(){var t=this.data,e=this.el;Object.keys(t).forEach(function(i){e.setAttribute(i,t[i])})}})},function(t,e){AFRAME.registerComponent("json-model",{schema:{src:{type:"asset"}},init:function(){this.objectLoader=new THREE.ObjectLoader,this.objectLoader.setCrossOrigin("")},update:function(t){var e=this,i=this.data.src;i&&i!==t.src&&this.objectLoader.load(this.data.src,function(t){var r=(new THREE.Matrix4).makeRotationX(-Math.PI/2);t.traverse(function(t){t instanceof THREE.Mesh&&t.position.applyMatrix4(r)}),e.el.setObject3D("mesh",t),e.el.emit("model-loaded",{format:"json",model:t,src:i})})}})},function(t,e){AFRAME.registerComponent("orbit-controls",{dependencies:["camera"],schema:{position:{default:{x:0,y:1.6,z:.1},type:"vec3"}},init:function(){var t=this.el.sceneEl,e=this.setupControls.bind(this);this.el.sceneEl.is("vr-mode")||this.el.setAttribute("position",this.data.position),t.canvas?e():t.addEventListener("render-target-loaded",e),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this),t.addEventListener("enter-vr",this.onEnterVR),t.addEventListener("exit-vr",this.onExitVR)},onExitVR:function(){this.el.setAttribute("position",this.data.position),this.controls.enabled=!0},onEnterVR:function(){if(AFRAME.utils.device.checkHeadsetConnected()||this.el.sceneEl.isMobile){var t=this.el.getAttribute("position"),e=this.el.getObject3D("camera");this.controls.enabled=!1,e.position.set(0,0,0),e.rotation.set(0,0,0),this.el.sceneEl.isMobile||this.el.setAttribute("position",{x:t.x-this.data.position.x,y:t.y-this.data.position.y,z:t.z-this.data.position.z})}},setupControls:function(){var t=this.el.sceneEl.renderer,e=this.el.getObject3D("camera"),i=this.controls=new THREE.OrbitControls(e,t.domElement),r=this.el.getAttribute("position");i.target.setX(-r.x),i.target.setZ(-r.z),i.enableDamping=!0,i.dampingFactor=1,i.enableZoom=!0},play:function(){this.controls&&(this.controls.enabled=!0)},pause:function(){this.controls&&(this.controls.enabled=!1)},remove:function(){this.pause()}})},function(t,e){AFRAME.registerSystem("paint-controls",{numberStrokes:0}),AFRAME.registerComponent("paint-controls",{dependencies:["brush"],schema:{hand:{default:"left"}},init:function(){function t(t){var e=i.highLightMaterial=new THREE.MeshBasicMaterial;e.map=t,e.needsUpdate=!0}var e=this.el,i=this,r="assets/images/controller-pressed.png",s=null;this.controller=null,this.modelLoaded=!1,this.onModelLoaded=this.onModelLoaded.bind(this),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("changeBrushSizeAbs",function(t){if((0!==t.detail.axis[0]||0!==t.detail.axis[1])&&i.previousAxis!==t.detail.axis[1]){var r=t.detail.axis[1]/300,s=e.components.brush.schema.size,n=THREE.Math.clamp(i.el.getAttribute("brush").size-r,s.min,s.max);i.el.setAttribute("brush","size",n)}}),e.addEventListener("changeBrushSizeInc",function(t){if((0!==t.detail.axis[0]||0!==t.detail.axis[1])&&i.previousAxis!==t.detail.axis[1]){i.touchStarted&&(i.touchStarted=!1,i.startAxis=(t.detail.axis[1]+1)/2);var r=(t.detail.axis[1]+1)/2,s=(i.startAxis-r)/2;i.startAxis=r;var n=i.el.getAttribute("brush").size,a=e.components.brush.schema.size,o=THREE.Math.clamp(n-s,a.min,a.max);i.el.setAttribute("brush","size",o)}}),i.touchStarted=!1,e.addEventListener("startChangeBrushSize",function(){i.touchStarted=!0}),e.addEventListener("controllerconnected",function(t){var i=t.detail.name;if("windows-motion-controls"===i){var r=t.detail.component.el.components["gltf-model"].data;const n="045E-065D";r&&r.indexOf(n)>=0&&(i="windows-motion-samsung-controls")}if(s=Utils.getTooltips(i),i.indexOf("windows-motion")>=0);else if("oculus-touch-controls"===i){var a=t.detail.component.data.hand;e.setAttribute("obj-model",{obj:"assets/models/oculus-"+a+"-controller.obj",mtl:"https://cdn.aframe.io/controllers/oculus/oculus-touch-controller-"+a+".mtl"})}else{if("vive-controls"!==i)return;e.setAttribute("json-model",{src:"assets/models/controller_vive.json"})}s&&s.forEach(function(t){t.setAttribute("visible",!0)}),this.controller=i}),e.addEventListener("brushsize-changed",function(t){i.changeBrushSize(t.detail.size)}),e.addEventListener("brushcolor-changed",function(t){i.changeBrushColor(t.detail.color)}),e.sceneEl.systems.material.loadTexture(r,{src:r},t),this.startAxis=0,this.numberStrokes=0,document.addEventListener("stroke-started",function(t){if(t.detail.entity.components["paint-controls"]===i&&(i.numberStrokes++,i.system.numberStrokes++,3===i.system.numberStrokes)){var e=Array.prototype.slice.call(document.querySelectorAll("[tooltip]")),r={opacity:1},s=new AFRAME.TWEEN.Tween(r).to({opacity:0},1e3).onComplete(function(){e.forEach(function(t){t.setAttribute("visible",!1)})}).delay(2e3).onUpdate(function(){e.forEach(function(t){t.setAttribute("tooltip",{opacity:r.opacity})})});s.start()}})},changeBrushColor:function(t){this.modelLoaded&&this.buttonMeshes.sizeHint&&(this.buttonMeshes.colorTip.material.color.copy(t),this.buttonMeshes.sizeHint.material.color.copy(t))},changeBrushSize:function(t){var e=t/2*10;this.modelLoaded&&this.buttonMeshes.sizeHint&&this.buttonMeshes.sizeHint.scale.set(e,e,1)},mapping:{axis0:"trackpad",axis1:"trackpad",button0:"trackpad",button1:"trigger",button2:"grip",button3:"menu",button4:"system"},update:function(){var t=this.data,e=this.el;e.setAttribute("vive-controls",{hand:t.hand,model:!1}),e.setAttribute("oculus-touch-controls",{hand:t.hand,model:!1}),e.setAttribute("windows-motion-controls",{hand:t.hand})},play:function(){},pause:function(){},onModelLoaded:function(t){if(t.target===this.el){var e,i=t.detail.model;e=this.buttonMeshes={},e.sizeHint=i.getObjectByName("sizehint"),e.colorTip=i.getObjectByName("tip"),this.modelLoaded=!0,this.changeBrushSize(this.el.components.brush.data.size),this.changeBrushColor(this.el.components.brush.color)}},onButtonEvent:function(t,e){var i=this.mapping["button"+t];this.el.emit(i+e),this.updateModel(i,e)},updateModel:function(t,e){var i="up"===e?this.material:this.highLightMaterial,r=this.buttonMeshes,s=r&&r[t];if("down"===e&&s&&!this.material&&(i=this.material=s.material),i)return"grip"===t?(r.grip.left.material=i,void(r.grip.right.material=i)):void(s&&(s.material=i))}})},function(t,e){AFRAME.registerComponent("ui",{schema:{brightness:{default:1,max:1,min:0}},dependencies:["ui-raycaster"],init:function(){var t=this.el,e=this.uiEl=document.createElement("a-entity"),i=this.rayEl=document.createElement("a-entity");this.closed=!0,this.isTooltipPaused=!1,this.colorStack=["#272727","#727272","#FFFFFF","#24CAFF","#249F90","#F2E646","#EF2D5E"],this.bindMethods(),this.colorHasChanged=!0,this.highlightMaterials={},this.intersectedObjects=[],this.hoveredOffObjects=[],this.hoveredOnObjects=[],this.pressedObjects={},this.selectedObjects={},this.unpressedObjects={},this.brushButtonsMapping={},this.brushRegexp=/^(?!.*(fg|bg)$)brush[0-9]+/,this.colorHistoryRegexp=/^(?!.*(fg|bg)$)colorhistory[0-9]+$/,this.hsv={h:0,s:0,v:1},this.rayAngle=45,this.rayDistance=.2,this.cursorOffset=new THREE.Vector3(.06409,.01419,-.10242),e.setAttribute("material",{color:"#ffffff",flatShading:!0,shader:"flat",transparent:!0,fog:!1,src:"#uinormal"}),e.setAttribute("obj-model","obj:#uiobj"),e.setAttribute("position","0 0.04 -0.15"),e.setAttribute("scale","0 0 0"),e.setAttribute("visible",!1),e.classList.add("apainter-ui"),t.appendChild(e),i.setAttribute("line",""),t.appendChild(i),t.setAttribute("ui-raycaster",{far:this.rayDistance,objects:".apainter-ui",rotation:-this.rayAngle}),this.controller=null;var r=this;t.addEventListener("controllerconnected",function(i){var s=i.detail.name;r.tooltips=Utils.getTooltips(s),r.controller={name:s,hand:i.detail.component.data.hand},"oculus-touch-controls"===s?(r.uiEl.setAttribute("rotation","45 0 0"),e.setAttribute("position","0 0.13 -0.08"),r.rayAngle=0,t.setAttribute("ui-raycaster",{rotation:0})):"windows-motion-controls"===s&&(r.rayAngle=25,r.rayDistance=1,t.setAttribute("ui-raycaster",{rotation:-30,far:r.rayDistance})),r.el.isPlaying&&r.addToggleEvent()})},initColorWheel:function(){var t=this.objects.hueWheel,e="\t      varying vec2 vUv;\t      void main() {\t        vUv = uv;\t        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\t        gl_Position = projectionMatrix * mvPosition;\t      }\t      ",i="\t      #define M_PI2 6.28318530718\n \t      uniform float brightness;\t      varying vec2 vUv;\t      vec3 hsb2rgb(in vec3 c){\t          vec3 rgb = clamp(abs(mod(c.x * 6.0 + vec3(0.0, 4.0, 2.0), 6.0) - 3.0) - 1.0, \t                           0.0, \t                           1.0 );\t          rgb = rgb * rgb * (3.0 - 2.0 * rgb);\t          return c.z * mix( vec3(1.0), rgb, c.y);\t      }\t      \t      void main() {\t        vec2 toCenter = vec2(0.5) - vUv;\t        float angle = atan(toCenter.y, toCenter.x);\t        float radius = length(toCenter) * 2.0;\t        vec3 color = hsb2rgb(vec3((angle / M_PI2) + 0.5, radius, brightness));\t        gl_FragColor = vec4(color, 1.0);\t      }\t      ",r=new THREE.ShaderMaterial({uniforms:{brightness:{type:"f",value:this.hsv.v}},vertexShader:e,fragmentShader:i});t.material=r},bindMethods:function(){this.onComponentChanged=this.onComponentChanged.bind(this),this.onTriggerChanged=this.onTriggerChanged.bind(this),this.onIntersection=this.onIntersection.bind(this),this.onIntersected=this.onIntersected.bind(this),this.onIntersectionCleared=this.onIntersectionCleared.bind(this),this.onIntersectedCleared=this.onIntersectedCleared.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onStrokeStarted=this.onStrokeStarted.bind(this),this.toggleMenu=this.toggleMenu.bind(this)},tick:function(){this.el.components["ui-raycaster"].refreshObjects(),!this.closed&&this.handEl&&(this.updateIntersections(),this.handleHover(),this.handlePressedButtons())},onTriggerChanged:function(t){var e=t.detail.value;this.lastTriggerValue=e,t.detail.value>=.25?this.triggeredPressed=!0:(this.triggeredPressed=!1,this.handleButtonUp())},handleButtonDown:function(t,e){var i=t.name;if(!this.activeWidget||this.activeWidget===i){switch(this.activeWidget=i,!0){case"brightness"===i:this.onBrightnessDown(e);break;case"brushnext"===i:this.pressedObjects[i]||this.nextPage();break;case"brushprev"===i:this.pressedObjects[i]||this.previousPage();break;case"clear"===i:this.pressedObjects[i]||(this.el.sceneEl.systems.brush.clear(),this.playSound("ui_click1"));break;case"copy"===i:this.pressedObjects[i]||(this.copyBrush(),this.playSound("ui_click1"));break;case"hue"===i:this.onHueDown(e);break;case"save"===i:this.pressedObjects[i]||(this.el.sceneEl.systems.painter.upload(),this.playSound("ui_click1"));break;case"sizebg"===i:this.onBrushSizeBackgroundDown(e);break;case this.brushRegexp.test(i):this.onBrushDown(i);break;case this.colorHistoryRegexp.test(i):this.onColorHistoryButtonDown(t);break;default:this.activeWidget=void 0}this.pressedObjects[i]=t}},copyBrush:function(){var t=this.el.getAttribute("brush");this.handEl.setAttribute("brush","brush",t.brush),this.handEl.setAttribute("brush","color",t.color),this.handEl.setAttribute("brush","size",t.size),this.colorHasChanged=!0},handleButtonUp:function(){var t=this.pressedObjects,e=this.unpressedObjects;this.activeWidget=void 0,Object.keys(t).forEach(function(i){var r=t[i].name;switch(!0){case"size"===r:}e[r]=t[r],delete t[r]})},handlePressedButtons:function(){var t=this;this.triggeredPressed&&this.hoveredOnObjects.forEach(function(e){t.handleButtonDown(e.object,e.point)})},onColorHistoryButtonDown:function(t){var e=t.material.color.getHexString();this.handEl.setAttribute("brush","color","#"+e),this.playSound("ui_click0",t.name)},onBrushDown:function(t){var e=this.brushButtonsMapping[t];e&&(this.selectBrushButton(t),this.handEl.setAttribute("brush","brush",e.toLowerCase()))},selectBrushButton:function(t){var e=this.uiEl.getObject3D("mesh").getObjectByName(t+"bg"),i=this.selectedObjects,r=this.selectedBrush;
r&&(this.highlightMaterials[r.name]||this.initHighlightMaterial(e),r.material=this.highlightMaterials[r.name].normal,delete i[r.name]),i[e.name]=e,this.selectedBrush=e,this.playSound("ui_click1",t)},onHueDown:function(t){var e,i=this.objects.hueWheel,r=this.colorWheelSize;i.updateMatrixWorld(),i.worldToLocal(t),this.objects.hueCursor.position.copy(t),e={r:Math.sqrt(t.x*t.x+t.z*t.z),theta:Math.PI+Math.atan2(-t.z,t.x)};var s=(e.theta*(180/Math.PI)+180)%360;this.hsv.h=s/360,this.hsv.s=e.r/r,this.updateColor(),this.playSound("ui_click0","hue")},updateColor:function(){var t=this.hsv2rgb(this.hsv),e="rgb("+t.r+", "+t.g+", "+t.b+")";this.handEl.setAttribute("brush","color",e),this.colorHasChanged=!0},hsv2rgb:function(t){var e,i,r,s,n,a,o,h,u=THREE.Math.clamp(t.h,0,1),c=THREE.Math.clamp(t.s,0,1),l=t.v;switch(s=Math.floor(6*u),n=6*u-s,a=l*(1-c),o=l*(1-n*c),h=l*(1-(1-n)*c),s%6){case 0:e=l,i=h,r=a;break;case 1:e=o,i=l,r=a;break;case 2:e=a,i=l,r=h;break;case 3:e=a,i=o,r=l;break;case 4:e=h,i=a,r=l;break;case 5:e=l,i=a,r=o}return{r:Math.round(255*e),g:Math.round(255*i),b:Math.round(255*r)}},rgb2hsv:function(t,e,i){var r,s=Math.max(t,e,i),n=Math.min(t,e,i),a=s-n,o=0===s?0:a/s,h=s;switch(1===arguments.length&&(e=t.g,i=t.b,t=t.r),s){case n:r=0;break;case t:r=e-i+a*(e<i?6:0),r/=6*a;break;case e:r=i-t+2*a,r/=6*a;break;case i:r=t-e+4*a,r/=6*a}return{h:r,s:o,v:h}},onBrightnessDown:function(t){var e=this.objects.brightnessSlider,i=e.geometry.boundingBox,r=i.max.z-i.min.z;e.updateMatrixWorld(),e.worldToLocal(t);var s=1-(t.z-i.min.z)/r;s=THREE.Math.clamp(1.29*s-.12,0,1),this.objects.hueWheel.material.uniforms.brightness.value=s,this.objects.brightnessCursor.rotation.y=1.5*s-1.5,this.hsv.v=s,this.updateColor(),this.playSound("ui_click0","brightness")},onBrushSizeBackgroundDown:function(t){var e=this.objects.sizeSlider,i=e.geometry.boundingBox,r=i.max.x-i.min.x;e.updateMatrixWorld(),e.worldToLocal(t);var s=(t.x-i.min.x)/r;s*=AFRAME.components.brush.schema.size.max,this.handEl.setAttribute("brush","size",s),this.playSound("ui_click0","sizebg")},handleHover:function(){this.updateHoverObjects(),this.updateMaterials()},updateHoverObjects:function(){var t=this.intersectedObjects;t=t.filter(function(t){return"bb"!==t.object.name&&"msg_save"!==t.object.name}),this.hoveredOffObjects=this.hoveredOnObjects.filter(function(e){return t.indexOf(e)===-1}),this.hoveredOnObjects=t},updateMaterials:function(){var t=new THREE.Vector3;return function(){var e=this,i=this.pressedObjects,r=this.unpressedObjects,s=this.selectedObjects;this.hoveredOffObjects.forEach(function(t){var i=t.object;i.material=e.highlightMaterials[i.name].normal}),this.hoveredOnObjects.forEach(function(i){var r=i.object;t.copy(i.point),e.highlightMaterials[r.name]||e.initHighlightMaterial(r),e.handRayEl.object3D.worldToLocal(t),e.handRayEl.setAttribute("line","end",t),r.material=e.highlightMaterials[r.name].hover}),Object.keys(i).forEach(function(t){var r=i[t],s=e.highlightMaterials[r.name];r.material=s.pressed||r.material}),Object.keys(r).forEach(function(t){var i=r[t],s=e.highlightMaterials[i.name];i.material=s.normal,delete r[t]}),Object.keys(s).forEach(function(t){var i=s[t],r=e.highlightMaterials[i.name];r&&(i.material=r.selected)})}}(),addToggleEvent:function(){this.el.addEventListener("toggleMenu",this.toggleMenu)},removeToggleEvent:function(){this.el.removeEventListener("toggleMenu",this.toggleMenu)},play:function(){var t=this.el,e=this.handEl;this.controller&&this.addToggleEvent(),t.addEventListener("model-loaded",this.onModelLoaded),t.addEventListener("raycaster-intersection",this.onIntersection),t.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),t.addEventListener("raycaster-intersected",this.onIntersected),t.addEventListener("raycaster-intersected-cleared",this.onIntersectedCleared),e&&this.addHandListeners()},pause:function(){var t=this.el,e=this.handEl;this.controller&&this.removeToggleEvent(),t.removeEventListener("raycaster-intersection",this.onIntersection),t.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),t.removeEventListener("raycaster-intersected",this.onIntersected),t.removeEventListener("raycaster-intersected-cleared",this.onIntersectedCleared),e&&this.removeHandListeners()},onModelLoaded:function(t){function e(t){t.visible=!0;var e={opacity:0},i=new AFRAME.TWEEN.Tween(e).to({opacity:1},500).onUpdate(function(){n.messagesMaterial.opacity=e.opacity}).chain(new AFRAME.TWEEN.Tween(e).to({opacity:0},500).delay(3e3).onComplete(function(){t.visible=!1}).onUpdate(function(){n.messagesMaterial.opacity=e.opacity}));i.start()}var i=this.uiEl,r=i.getObject3D("mesh");if(r=t.detail.model,"obj"===t.detail.format&&r.getObjectByName("brightnesscursor")){this.objects={},this.objects.brightnessCursor=r.getObjectByName("brightnesscursor"),this.objects.brightnessSlider=r.getObjectByName("brightness"),this.objects.brightnessSlider.geometry.computeBoundingBox(),this.objects.previousPage=r.getObjectByName("brushprev"),this.objects.nextPage=r.getObjectByName("brushnext"),this.objects.hueCursor=r.getObjectByName("huecursor"),this.objects.hueWheel=r.getObjectByName("hue"),this.objects.hueWheel.geometry.computeBoundingSphere(),this.colorWheelSize=this.objects.hueWheel.geometry.boundingSphere.radius,this.objects.sizeCursor=r.getObjectByName("size"),this.objects.sizeCursor.position.copy(this.cursorOffset),this.objects.colorHistory=[];for(var s=0;s<7;s++)this.objects.colorHistory[s]=r.getObjectByName("colorhistory"+s);this.objects.currentColor=r.getObjectByName("currentcolor"),this.objects.sizeSlider=r.getObjectByName("sizebg"),this.objects.sizeSlider.geometry.computeBoundingBox(),r.getObjectByName("bb").material=new THREE.MeshBasicMaterial({color:2395940,alphaTest:0,visible:!1});var n=this;this.messagesMaterial=new THREE.MeshBasicMaterial({map:null,transparent:!0,opacity:0}),this.objects.messageSave=r.getObjectByName("msg_save"),this.objects.messageSave.material=this.messagesMaterial,this.objects.messageSave.visible=!1,this.objects.messageError=r.getObjectByName("msg_error"),this.objects.messageError.visible=!1,this.objects.messageError.material=this.messagesMaterial;var a="assets/images/messages.png";this.el.sceneEl.systems.material.loadTexture(a,{src:a},function(t){var e=n.messagesMaterial;e.map=t,e.needsUpdate=!0}),this.el.sceneEl.addEventListener("drawing-upload-completed",function(t){e(n.objects.messageSave)}),this.el.sceneEl.addEventListener("drawing-upload-error",function(t){e(n.objects.messageError)}),this.initColorWheel(),this.initColorHistory(),this.initBrushesMenu(),this.setCursorTransparency(),this.updateColorUI(this.el.getAttribute("brush").color),this.updateSizeSlider(this.el.getAttribute("brush").size)}},initBrushesMenu:function(){var t=this.objects.previousPage,e=this.objects.nextPage,i=Object.keys(AFRAME.BRUSHES);this.initHighlightMaterial(e),this.initHighlightMaterial(t),t.visible=!1,e.visible=!1,this.brushesPerPage=15,this.brushesPagesNum=Math.ceil(i.length/this.brushesPerPage),this.brushesPage=0,this.loadBrushes(this.brushesPage,this.brushesPerPage)},setCursorTransparency:function(){var t=this.objects.hueCursor,e=this.objects.brightnessCursor,i=this.objects.sizeCursor;i.material.alphaTest=.5,t.material.alphaTest=.5,e.material.alphaTest=.5,i.material.transparent=!0,t.material.transparent=!0,e.material.transparent=!0},loadBrushes:function(){var t={};return function(e,i){function r(e,i,r){function n(t){var e=c.getObjectByName("brush"+i);d.brushButtonsMapping["brush"+i]=a,s(t,e)}var a=e?(e.charAt(0).toUpperCase()+e.slice(1)).toLowerCase():void 0;return r&&!t[a]?void d.el.sceneEl.systems.material.loadTexture(r,{src:r},n):void n()}function s(e,i){var r=d.brushButtonsMapping[i.name],s=t[r]||new THREE.MeshBasicMaterial;e?(s.map=e,s.alphaTest=.5,s.transparent=!0):t[r]||(s.visible=!1),t[r]=s,d.highlightMaterials[i.name]={normal:s,hover:s,pressed:s,selected:s},i.material=s}var n,a,o,h,u=0,c=this.uiEl.getObject3D("mesh"),l=Object.keys(AFRAME.BRUSHES),d=this;if(!(e<0||e>=this.brushesPagesNum))for(0===e?this.objects.previousPage.visible=!1:this.objects.previousPage.visible=!0,e===this.brushesPagesNum-1?this.objects.nextPage.visible=!1:this.objects.nextPage.visible=!0,h=0;h<i;h++)o=e*i+h,n=l[o],a=n&&AFRAME.BRUSHES[n].prototype.options.thumbnail,r(n,u,a),u+=1}}(),nextPage:function(){this.brushesPage>=this.brushesPagesNum-1||(this.brushesPage++,this.loadBrushes(this.brushesPage,this.brushesPerPage),this.playSound("ui_click1"))},previousPage:function(){0!==this.brushesPage&&(this.brushesPage--,this.loadBrushes(this.brushesPage,this.brushesPerPage),this.playSound("ui_click1"))},initHighlightMaterial:function(t){var e=t.name,i=this.brushRegexp.test(e),r=e.indexOf("history")!==-1,s="hue"===e||"huecursor"===e,n={normal:t.material,hover:t.material,pressed:t.material,selected:t.material};i||r||s||(n.normal=t.material,n.hover=t.material.clone(),n.hover.map=this.system.hoverTexture,n.selected=t.material.clone(),n.selected.map=this.system.pressedTexture,n.pressed=t.material.clone(),n.pressed.map=this.system.pressedTexture),this.highlightMaterials[e]=n},toggleMenu:function(t){this.closed?(this.system.closeAll(),this.open(),this.system.opened=this.el):(this.close(),this.system.opened=void 0)},open:function(){var t,e=this.uiEl,i={x:0,y:0,z:0};if(this.closed){if(this.uiEl.setAttribute("visible",!0),t=new AFRAME.TWEEN.Tween(i).to({x:1,y:1,z:1},100).onUpdate(function(){e.setAttribute("scale",this)}).easing(AFRAME.TWEEN.Easing.Exponential.Out),t.start(),this.el.setAttribute("brush","enabled",!1),this.rayEl.setAttribute("visible",!1),this.closed=!1,this.tooltips){var r=this;this.tooltips.forEach(function(t){t.getAttribute("visible")&&e.parentEl.id!==t.parentEl.id&&(r.isTooltipPaused=!0,t.setAttribute("visible",!1))})}this.playSound("ui_menu")}},updateIntersections:function(){var t=this.raycaster=new THREE.Raycaster;return function(e){this.updateRaycaster(t),this.intersectedObjects=t.intersectObjects(this.menuEls,!0)}}(),onIntersection:function(t){var e=this.closed&&this.system.opened;this.el.components.brush.active||(this.rayEl.setAttribute("visible",!!e),this.el.setAttribute("brush","enabled",!1))},onIntersected:function(t){var e=t.detail.el;this.handEl&&this.removeHandListeners(),this.handEl=e,this.handRayEl=this.handEl.components.ui.rayEl,this.menuEls=this.uiEl.object3D.children,this.syncUI(),this.addHandListeners()},addHandListeners:function(){var t=this.handEl;t.addEventListener("componentchanged",this.onComponentChanged),t.addEventListener("stroke-started",this.onStrokeStarted),t.addEventListener("triggerchanged",this.onTriggerChanged)},removeHandListeners:function(){var t=this.handEl;t.removeEventListener("componentchanged",this.onComponentChanged),t.removeEventListener("stroke-started",this.onStrokeStarted),t.removeEventListener("triggerchanged",this.onTriggerChanged)},onComponentChanged:function(t){"brush"===t.detail.name&&this.syncUI()},syncUI:function(){var t;this.handEl&&this.objects&&(t=this.handEl.getAttribute("brush"),this.updateSizeSlider(t.size),this.updateColorUI(t.color),this.updateColorHistory())},initColorHistory:function(){for(var t,e=this.objects.currentColor,i=0;i<this.objects.colorHistory.length;i++)t=this.objects.colorHistory[i],t.material=t.material.clone(),t.material.map=this.system.selectedTexture;e.material=e.material.clone(),e.material.map=this.system.selectedTexture,this.updateColorHistory()},updateColorHistory:function(){var t=this.handEl&&this.handEl.getAttribute("brush").color,e=this.colorStack;t||(t=this.el.components.brush.schema.color.default),this.objects.currentColor.material.color.set(t);for(var i=0;i<e.length;i++)t=e[e.length-i-1],this.objects.colorHistory[i].material.color.set(t)},updateSizeSlider:function(t){var e=this.objects.sizeSlider,i=e.geometry.boundingBox,r=this.objects.sizeCursor,s=i.max.x-i.min.x,n=t/AFRAME.components.brush.schema.size.max,a=n*s;r.position.setX(a-this.cursorOffset.x);var o=n+.3;r.scale.set(o,1,o)},updateColorUI:function(t){var e=new THREE.Color(t),i=this.hsv=this.rgb2hsv(e.r,e.g,e.b),r=2*i.h*Math.PI,s=i.s*this.colorWheelSize,n=s*Math.cos(r),a=s*Math.sin(r);this.objects.hueCursor.position.setX(n),this.objects.hueCursor.position.setZ(-a),this.objects.hueWheel.material.uniforms.brightness.value=this.hsv.v,this.objects.brightnessCursor.rotation.y=1.5*this.hsv.v-1.5},updateBrushSelector:function(t){var e=this,i=Object.keys(this.brushButtonsMapping),r=this.brushButtonsMapping;i.forEach(function(i){r[i]===t&&e.selectBrushButton(i)})},onIntersectionCleared:function(){this.checkMenuIntersections=!1,this.rayEl.setAttribute("visible",!1),this.el.setAttribute("brush","enabled",!0)},onIntersectedCleared:function(t){this.handEl&&this.handEl.removeEventListener("triggerchanged",this.onTriggerChanged)},onStrokeStarted:function(){var t,e=this.colorStack;this.colorHasChanged&&(t=this.handEl.getAttribute("brush").color,this.colorHasChanged=!1,7===e.length&&e.shift(),e.push(t),this.syncUI())},updateRaycaster:function(){var t=new THREE.Vector3,e=new THREE.Quaternion,i=new THREE.Vector3,r=new THREE.Vector3;return function(s){var n=this.handEl.object3D;n.updateMatrixWorld(),n.matrixWorld.decompose(r,e,i),t.set(0,0,-1),t.applyAxisAngle(new THREE.Vector3(1,0,0),2*-(this.rayAngle/360)*Math.PI),t.applyQuaternion(e),s.far=this.rayDistance,s.set(r,t)}}(),close:function(){var t,e=this.uiEl,i={x:1,y:1,z:1};this.closed||(t=new AFRAME.TWEEN.Tween(i).to({x:0,y:0,z:0},100).onUpdate(function(){e.setAttribute("scale",this)}).onComplete(function(){e.setAttribute("visible",!1)}).easing(AFRAME.TWEEN.Easing.Exponential.Out),t.start(),this.el.setAttribute("brush","enabled",!0),this.closed=!0,this.tooltips&&this.isTooltipPaused&&(this.isTooltipPaused=!1,this.tooltips.forEach(function(t){t.setAttribute("visible",!0)})),this.playSound("ui_menu"))},playSound:function(t,e){void 0!==e&&this.pressedObjects[e]||document.getElementById(t).play()}})},function(t,e){AFRAME.registerComponent("ui-raycaster",{schema:{far:{default:1/0},interval:{default:100},near:{default:0},objects:{default:""},recursive:{default:!0},rotation:{default:0}},init:function(){this.direction=new THREE.Vector3,this.intersectedEls=[],this.objects=null,this.prevCheckTime=void 0,this.raycaster=new THREE.Raycaster,this.updateOriginDirection(),this.refreshObjects=this.refreshObjects.bind(this)},play:function(){this.el.sceneEl.addEventListener("child-attached",this.refreshObjects),this.el.sceneEl.addEventListener("child-detached",this.refreshObjects)},pause:function(){this.el.sceneEl.removeEventListener("child-attached",this.refreshObjects),this.el.sceneEl.removeEventListener("child-detached",this.refreshObjects)},update:function(){var t=this.data,e=this.raycaster;e.far=t.far,e.near=t.near,this.refreshObjects()},refreshObjects:function(){var t,e,i=this.data;if(i.objects)for(e=this.el.sceneEl.querySelectorAll(i.objects),this.objects=[],t=0;t<e.length;t++)this.objects.push(e[t].object3D);else this.objects=this.el.sceneEl.object3D.children},tick:function(t){var e,i,r,s=this.el,n=this.data,a=this.prevCheckTime;a&&t-a<n.interval||(r=this.intersectedEls.slice(),this.updateOriginDirection(),i=this.raycaster.intersectObjects(this.objects,n.recursive),i=i.filter(function(t){return!!t.object.el}),e=this.intersectedEls=i.map(function(t){return t.object.el}),i.forEach(function(t){var e=t.object.el;e.emit("raycaster-intersected",{el:s,intersection:t})}),i.length&&s.emit("raycaster-intersection",{els:e,intersections:i}),r.forEach(function(t){e.indexOf(t)===-1&&(s.emit("raycaster-intersection-cleared",{el:t}),t.emit("raycaster-intersected-cleared",{el:s}))}))},updateOriginDirection:function(){var t=new THREE.Quaternion,e=new THREE.Vector3,i=new THREE.Vector3;return function(){var r=this.el,s=this.direction,n=r.object3D;n.updateMatrixWorld(),n.matrixWorld.decompose(e,t,i),s.set(0,0,-1),s.applyAxisAngle(new THREE.Vector3(1,0,0),this.data.rotation/360*2*Math.PI),s.applyQuaternion(t),this.raycaster.set(e,s)}}()})},function(t,e,i){var r=i(9),s=i(26);!function(){s(function(){var t={vertexColors:THREE.VertexColors,side:THREE.DoubleSide},e={roughness:.75,metalness:.25,vertexColors:THREE.VertexColors,map:window.atlas.map,side:THREE.DoubleSide},i={roughness:.75,metalness:.25,vertexColors:THREE.VertexColors,side:THREE.DoubleSide,map:window.atlas.map,transparent:!0,alphaTest:.5};r.addSharedBuffer("strip-flat",new THREE.MeshBasicMaterial(t),THREE.TriangleStripDrawMode),r.addSharedBuffer("strip-shaded",new THREE.MeshStandardMaterial(e),THREE.TriangleStripDrawMode),r.addSharedBuffer("strip-textured",new THREE.MeshStandardMaterial(i),THREE.TriangleStripDrawMode)});for(var t={init:function(t,e){this.sharedBuffer=r.getSharedBuffer("strip-"+this.materialOptions.type),this.sharedBuffer.restartPrimitive(),this.prevIdx=Object.assign({},this.sharedBuffer.idx),this.idx=Object.assign({},this.sharedBuffer.idx),this.first=!0},remove:function(){this.sharedBuffer.remove(this.prevIdx,this.idx)},undo:function(){this.sharedBuffer.undo(this.prevIdx)},addPoint:function(){var t=new THREE.Vector3;return function(e,i,r,s,n){var a=this.materialOptions.converter;t.set(1,0,0),t.applyQuaternion(i),t.normalize();var o=r.clone(),h=r.clone(),u=this.data.size*s;if(o.add(t.clone().multiplyScalar(u/2)),h.add(t.clone().multiplyScalar(-u/2)),this.first&&this.prevIdx.position>0&&(this.first=!1,this.sharedBuffer.addVertex(o.x,o.y,o.z),this.sharedBuffer.idx.normal++,this.sharedBuffer.idx.color++,this.sharedBuffer.idx.uv++,this.idx=Object.assign({},this.sharedBuffer.idx)),this.sharedBuffer.addVertex(o.x,o.y,o.z),this.sharedBuffer.addVertex(h.x,h.y,h.z),this.sharedBuffer.idx.normal+=2,this.sharedBuffer.addColor(this.data.color.r,this.data.color.g,this.data.color.b),this.sharedBuffer.addColor(this.data.color.r,this.data.color.g,this.data.color.b),"textured"===this.materialOptions.type){this.sharedBuffer.idx.uv+=2;for(var c,l,d=this.sharedBuffer.current.attributes.uv.array,m=0;m<this.data.numPoints+1;m++)c=m/this.data.numPoints,l=4*m,0!==this.prevIdx.uv&&(l+=2*(this.prevIdx.uv+1)),d[l]=a.convertU(c),d[l+1]=a.convertV(0),d[l+2]=a.convertU(c),d[l+3]=a.convertV(1)}return this.idx=Object.assign({},this.sharedBuffer.idx),this.sharedBuffer.update(),this.computeStripVertexNormals(),!0}}(),computeStripVertexNormals:function(){var t=new THREE.Vector3,e=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3;return function(){for(var n=0===this.prevIdx.position?0:3*(this.prevIdx.position+1),a=3*this.idx.position,o=this.sharedBuffer.current.attributes.position.array,h=this.sharedBuffer.current.attributes.normal.array,u=n;u<=a;u++)h[u]=0;var c=!0;for(u=n;u<a-6;u+=3)c?(t.fromArray(o,u),e.fromArray(o,u+3),i.fromArray(o,u+6)):(e.fromArray(o,u),i.fromArray(o,u+6),t.fromArray(o,u+3)),c=!c,r.subVectors(i,e),s.subVectors(t,e),r.cross(s),r.normalize(),h[u]+=r.x,h[u+1]+=r.y,h[u+2]+=r.z,h[u+3]+=r.x,h[u+4]+=r.y,h[u+5]+=r.z,h[u+6]+=r.x,h[u+7]+=r.y,h[u+8]+=r.z;for(u=n+6;u<a-6;u++)h[u]=h[u]/3;h[n+3]=h[n+3]/2,h[n+3+1]=h[n+3+1]/2,h[n+3+2]=h[n+3+2]/2,h[a-6]=h[a-6]/2,h[a-6+1]=h[a-6+1]/2,h[a-6+2]=h[a-6+2]/2}}()},e=[{name:"flat",materialOptions:{type:"flat"},thumbnail:"brushes/thumb_flat.gif"},{name:"smooth",materialOptions:{type:"shaded"},thumbnail:"brushes/thumb_smooth.gif"},{name:"squared-textured",materialOptions:{type:"textured",textureSrc:"brushes/squared_textured.png"},thumbnail:"brushes/thumb_squared_textured.gif"},{name:"line-gradient",materialOptions:{type:"textured",textureSrc:"brushes/line_gradient.png"},thumbnail:"brushes/thumb_line_gradient.gif"},{name:"silky-flat",materialOptions:{type:"textured",textureSrc:"brushes/silky_flat.png"},thumbnail:"brushes/thumb_silky_flat.gif"},{name:"silky-textured",materialOptions:{type:"textured",textureSrc:"brushes/silky_textured.png"},thumbnail:"brushes/thumb_silky_textured.gif"},{name:"lines1",materialOptions:{type:"textured",textureSrc:"brushes/lines1.png"},thumbnail:"brushes/thumb_lines1.gif"},{name:"lines2",materialOptions:{type:"textured",textureSrc:"brushes/lines2.png"},thumbnail:"brushes/thumb_lines2.gif"},{name:"lines3",materialOptions:{type:"textured",textureSrc:"brushes/lines3.png"},thumbnail:"brushes/thumb_lines3.gif"},{name:"lines4",materialOptions:{type:"textured",textureSrc:"brushes/lines4.png"},thumbnail:"brushes/thumb_lines4.gif"},{name:"lines5",materialOptions:{type:"textured",textureSrc:"brushes/lines5.png"},thumbnail:"brushes/thumb_lines5.gif"},{name:"line-grunge1",materialOptions:{type:"textured",textureSrc:"brushes/line_grunge1.png"},thumbnail:"brushes/thumb_line_grunge1.gif"},{name:"line-grunge2",materialOptions:{type:"textured",textureSrc:"brushes/line_grunge2.png"},thumbnail:"brushes/thumb_line_grunge2.gif"},{name:"line-grunge3",materialOptions:{type:"textured",textureSrc:"brushes/line_grunge3.png"},thumbnail:"brushes/thumb_line_grunge3.gif"}],i=0;i<e.length;i++){var n=e[i];n.materialOptions.textureSrc?n.materialOptions.converter=window.atlas.getUVConverters(n.materialOptions.textureSrc):n.materialOptions.converter=window.atlas.getUVConverters(null),AFRAME.registerBrush(n.name,Object.assign({},t,{materialOptions:n.materialOptions}),{thumbnail:n.thumbnail,maxPoints:3e3})}}()},function(t,e){t.exports=function(t){function e(){var e=document.querySelector("a-scene");e.hasLoaded?t():e.addEventListener("loaded",t())}"complete"===document.readyState||"loaded"===document.readyState?e():document.addEventListener("DOMContentLoaded",e)}},function(t,e,i){var r=i(9),s=i(26);!function(){s(function(){var t=new THREE.MeshStandardMaterial({side:THREE.DoubleSide,map:window.atlas.map,vertexColors:THREE.VertexColors,transparent:!0,alphaTest:.5,roughness:.75,metalness:.25}),e=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:window.atlas.map,vertexColors:THREE.VertexColors,transparent:!0,alphaTest:.5});r.addSharedBuffer("tris-flat",e,THREE.TrianglesDrawMode),r.addSharedBuffer("tris-shaded",t,THREE.TrianglesDrawMode)});for(var t={init:function(t,e){this.sharedBuffer=r.getSharedBuffer("tris-"+this.materialOptions.type),this.prevIdx=Object.assign({},this.sharedBuffer.idx),this.idx=Object.assign({},this.sharedBuffer.idx),this.currAngle=0,this.subTextures=1,this.angleJitter=0,this.autoRotate=!1,void 0!==this.materialOptions.subTextures&&(this.subTextures=this.materialOptions.subTextures),this.materialOptions.autoRotate===!0&&(this.autoRotate=!0),void 0!==this.materialOptions.angleJitter&&(this.angleJitter=this.materialOptions.angleJitter,this.angleJitter=2*this.angleJitter-this.angleJitter)},remove:function(){this.sharedBuffer.remove(this.prevIdx,this.idx)},undo:function(){this.sharedBuffer.undo(this.prevIdx)},addPoint:function(){var t=new THREE.Vector3,e=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3,n=new THREE.Vector3,a=new THREE.Vector3,o=Math.PI/2;return function(h,u,c,l,d){e.set(1,0,0),e.applyQuaternion(u),e.normalize(),t.set(0,1,0),t.applyQuaternion(u),t.normalize();var m=this.data.size*l/2,p=Math.PI/4+Math.random()*this.angleJitter;this.autoRotate&&(this.currAngle+=.1,p+=this.currAngle),i.copy(c).add(a.copy(e.applyAxisAngle(t,p)).multiplyScalar(m)),r.copy(c).add(a.copy(e.applyAxisAngle(t,o)).multiplyScalar(m)),s.copy(c).add(a.copy(e.applyAxisAngle(t,o)).multiplyScalar(m)),n.copy(c).add(e.applyAxisAngle(t,o).multiplyScalar(m));this.idx.position,this.idx.position;this.sharedBuffer.addVertex(i.x,i.y,i.z),this.sharedBuffer.addVertex(r.x,r.y,r.z),this.sharedBuffer.addVertex(s.x,s.y,s.z),this.sharedBuffer.addVertex(s.x,s.y,s.z),this.sharedBuffer.addVertex(n.x,n.y,n.z),this.sharedBuffer.addVertex(i.x,i.y,i.z);for(var f=0;f<6;f++)this.sharedBuffer.addNormal(t.x,t.y,t.z),this.sharedBuffer.addColor(this.data.color.r,this.data.color.g,this.data.color.b);var g=(6*this.data.numPoints*2,0),b=1;if(this.subTextures>1){var v=Math.floor(Math.random()*this.subTextures);g=1/this.subTextures*v,b=g+1/this.subTextures}var E=this.materialOptions.converter;return this.sharedBuffer.addUV(E.convertU(g),E.convertV(1)),this.sharedBuffer.addUV(E.convertU(g),E.convertV(0)),this.sharedBuffer.addUV(E.convertU(b),E.convertV(0)),this.sharedBuffer.addUV(E.convertU(b),E.convertV(0)),this.sharedBuffer.addUV(E.convertU(b),E.convertV(1)),this.sharedBuffer.addUV(E.convertU(g),E.convertV(1)),this.idx=Object.assign({},this.sharedBuffer.idx),this.sharedBuffer.update(),!0}}()},e=[{name:"dots",materialOptions:{type:"shaded",textureSrc:"brushes/stamp_dots.png"},thumbnail:"brushes/thumb_stamp_dots.gif",spacing:.01},{name:"squares",materialOptions:{type:"shaded",textureSrc:"brushes/stamp_squares.png"},thumbnail:"brushes/thumb_stamp_squares.gif",spacing:.01},{name:"column",materialOptions:{type:"shaded",autoRotate:!0,textureSrc:"brushes/stamp_column.png"},thumbnail:"brushes/thumb_stamp_column.gif",spacing:.01},{name:"gear1",materialOptions:{type:"shaded",angleJitter:2*Math.PI,subTextures:2,textureSrc:"brushes/stamp_gear.png"},thumbnail:"brushes/thumb_stamp_gear.gif",spacing:.05},{name:"grunge1",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge1.png"},thumbnail:"brushes/stamp_grunge1.png",spacing:.02},{name:"grunge2",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge2.png"},thumbnail:"brushes/stamp_grunge2.png",spacing:.02},{name:"grunge3",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge3.png"},thumbnail:"brushes/stamp_grunge3.png",spacing:.02},{name:"grunge4",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge4.png"},thumbnail:"brushes/stamp_grunge4.png",spacing:.02},{name:"grunge5",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge5.png"},thumbnail:"brushes/thumb_stamp_grunge5.gif",spacing:.02},{name:"leaf1",materialOptions:{type:"shaded",angleJitter:Math.PI,textureSrc:"brushes/stamp_leaf1.png"},thumbnail:"brushes/stamp_leaf1.png",spacing:.03},{name:"leaf2",materialOptions:{type:"shaded",angleJitter:60*Math.PI/180,textureSrc:"brushes/stamp_leaf2.png"},thumbnail:"brushes/thumb_stamp_leaf2.gif",spacing:.03},{name:"leaf3",materialOptions:{type:"shaded",angleJitter:60*Math.PI/180,textureSrc:"brushes/stamp_leaf3.png"},thumbnail:"brushes/thumb_stamp_leaf3.gif",spacing:.03},{name:"fur1",materialOptions:{type:"shaded",angleJitter:40*Math.PI/180,subTextures:2,textureSrc:"brushes/stamp_fur1.png"},thumbnail:"brushes/stamp_fur1.png",spacing:.01},{name:"fur2",materialOptions:{type:"shaded",angleJitter:10*Math.PI/180,subTextures:3,textureSrc:"brushes/stamp_fur2.png"},thumbnail:"brushes/stamp_fur2.png",spacing:.01},{name:"grass",materialOptions:{type:"shaded",angleJitter:10*Math.PI/180,subTextures:3,textureSrc:"brushes/stamp_grass.png"},thumbnail:"brushes/thumb_stamp_grass.png",spacing:.03},{name:"bush",materialOptions:{type:"shaded",subTextures:2,textureSrc:"brushes/stamp_bush.png"},thumbnail:"brushes/thumb_stamp_bush.gif",spacing:.04},{name:"star",materialOptions:{type:"shaded",textureSrc:"brushes/stamp_star.png"},thumbnail:"brushes/thumb_stamp_star.png",spacing:.06},{name:"snow",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_snow.png"},thumbnail:"brushes/thumb_stamp_snow.png",spacing:.06}],i=0;i<e.length;i++){var n=e[i];n.materialOptions.textureSrc&&(n.materialOptions.map=window.atlas.map,n.materialOptions.converter=window.atlas.getUVConverters(n.materialOptions.textureSrc),delete n.materialOptions.textureSrc),AFRAME.registerBrush(n.name,Object.assign({},t,{materialOptions:n.materialOptions}),{thumbnail:n.thumbnail,spacing:n.spacing,maxPoints:3e3})}}()},function(t,e){AFRAME.registerBrush("spheres",{init:function(t,e){this.material=new THREE.MeshStandardMaterial({color:this.data.color,roughness:.5,metalness:.5,side:THREE.DoubleSide,shading:THREE.FlatShading}),this.geometry=new THREE.IcosahedronGeometry(1,0)},addPoint:function(t,e,i,r,s){var n=new THREE.Mesh(this.geometry,this.material),a=this.data.size/2*r;return n.scale.set(a,a,a),n.initialScale=n.scale.clone(),n.phase=Math.random()*Math.PI*2,n.position.copy(i),n.rotation.copy(e),this.object3D.add(n),!0},tick:function(t,e){for(var i=0;i<this.object3D.children.length;i++){var r=this.object3D.children[i],s=(Math.sin(r.phase+t/500)+1)/2+.1;r.scale.copy(r.initialScale).multiplyScalar(s)}}},{thumbnail:"brushes/thumb_spheres.gif",spacing:.01})},function(t,e){AFRAME.registerBrush("cubes",{init:function(t,e){this.material=new THREE.MeshStandardMaterial({color:this.data.color,roughness:.5,metalness:.5,side:THREE.DoubleSide,shading:THREE.FlatShading}),this.geometry=new THREE.BoxGeometry(1,1,1)},addPoint:function(t,e,i,r,s){var n=new THREE.Mesh(this.geometry,this.material),a=r*this.data.size*Math.random();return n.scale.set(a,a,a),n.position.copy(i),n.rotation.copy(e),this.object3D.add(n),!0}},{thumbnail:"brushes/thumb_cubes.gif",spacing:.01})},function(t,e){!function(){var t="varying vec2 vUv; \t    void main() { \t      vUv = uv; \t      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 ); \t    }",e="uniform sampler2D tDiffuse; \t    uniform float amount; \t    uniform float time; \t    varying vec2 vUv; \t    \t    vec3 hsv2rgb(vec3 c) { \t        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0); \t        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www); \t        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y); \t    } \t    \t    void main() { \t      float h = mod(vUv.x - time / 3000.0, 1.0); \t      vec4 color = vec4(hsv2rgb(vec3(h, 1.0, 0.5)), 1.0); \t      gl_FragColor = color; \t    }",r=new THREE.ShaderMaterial({vertexShader:t,fragmentShader:e,side:THREE.DoubleSide,uniforms:{time:{type:"f",value:0}}});AFRAME.registerBrush("line-rainbow",{init:function(t,e){this.idx=0,this.geometry=new THREE.BufferGeometry,this.vertices=new Float32Array(3*this.options.maxPoints*3),this.uvs=new Float32Array(2*this.options.maxPoints*2),this.linepositions=new Float32Array(this.options.maxPoints),this.geometry.setDrawRange(0,0),this.geometry.addAttribute("position",new THREE.BufferAttribute(this.vertices,3).setDynamic(!0)),this.geometry.addAttribute("uv",new THREE.BufferAttribute(this.uvs,2).setDynamic(!0)),this.geometry.addAttribute("lineposition",new THREE.BufferAttribute(this.linepositions,1).setDynamic(!0)),this.material=r;var i=new THREE.Mesh(this.geometry,this.material);i.drawMode=THREE.TriangleStripDrawMode,i.frustumCulled=!1,i.vertices=this.vertices,this.object3D.add(i)},addPoint:function(){var t=new THREE.Vector3,e=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3;return function(n,a,o,h,u){var c=0;for(i=0;i<this.data.numPoints;i++)this.uvs[c++]=i/(this.data.numPoints-1),this.uvs[c++]=0,this.uvs[c++]=i/(this.data.numPoints-1),this.uvs[c++]=1;t.set(1,0,0),t.applyQuaternion(a),t.normalize(),e.copy(o),r.copy(o);var l=this.data.size*h;return e.add(s.copy(t).multiplyScalar(l/2)),r.add(s.copy(t).multiplyScalar(-l/2)),this.vertices[this.idx++]=e.x,this.vertices[this.idx++]=e.y,this.vertices[this.idx++]=e.z,this.vertices[this.idx++]=r.x,this.vertices[this.idx++]=r.y,this.vertices[this.idx++]=r.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.uv.needsUpdate=!0,this.geometry.setDrawRange(0,2*this.data.numPoints),!0}}(),tick:function(t,e){this.material.uniforms.time.value=t}},{thumbnail:"brushes/thumb_rainbow.png",maxPoints:3e3})}()},function(t,e){AFRAME.registerBrush("single-sphere",{init:function(t,e){this.material=new THREE.MeshStandardMaterial({color:this.data.color,roughness:.6,metalness:.2,side:THREE.FrontSide,shading:THREE.SmoothShading}),this.geometry=new THREE.IcosahedronGeometry(1,2),this.mesh=new THREE.Mesh(this.geometry,this.material),this.object3D.add(this.mesh),this.mesh.visible=!1},addPoint:function(t,e,i,r,s){this.firstPoint||(this.firstPoint=i.clone(),this.mesh.position.set(this.firstPoint.x,this.firstPoint.y,this.firstPoint.z)),this.mesh.visible=!0;var n=this.firstPoint.distanceTo(i);return this.mesh.scale.set(n,n,n),!0}},{thumbnail:"brushes/thumb_single_sphere.png",spacing:0})}]);